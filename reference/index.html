
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../how-to-guides/">
      
      
        <link rel="next" href="../explanation/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Reference - FedJust</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#federated-models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="FedJust" class="md-header__button md-logo" aria-label="FedJust" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            FedJust
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="FedJust" class="md-nav__button md-logo" aria-label="FedJust" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    FedJust
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FedJust Documentation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Quick set-up guide
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../how-to-guides/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FedJust - Adjustable Components
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#federated-models" class="md-nav__link">
    <span class="md-ellipsis">
      Federated Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model.federated_model" class="md-nav__link">
    <span class="md-ellipsis">
      federated_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel" class="md-nav__link">
    <span class="md-ellipsis">
      FederatedModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FederatedModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.__init__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.attach_dataset_id" class="md-nav__link">
    <span class="md-ellipsis">
      attach_dataset_id
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_dataset_id">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.attach_dataset_id--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.evaluate_model" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="evaluate_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.evaluate_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.evaluate_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_gradients" class="md-nav__link">
    <span class="md-ellipsis">
      get_gradients
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_gradients">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_gradients--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_gradients--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_gradients--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_weights" class="md-nav__link">
    <span class="md-ellipsis">
      get_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_weights--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.preserve_initial_model" class="md-nav__link">
    <span class="md-ellipsis">
      preserve_initial_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="preserve_initial_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.preserve_initial_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.preserve_initial_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.store_model_on_disk" class="md-nav__link">
    <span class="md-ellipsis">
      store_model_on_disk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="store_model_on_disk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.store_model_on_disk--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.store_model_on_disk--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
    <nav class="md-nav" aria-label="train">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.train--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.train--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.transform_func" class="md-nav__link">
    <span class="md-ellipsis">
      transform_func
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform_func">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.transform_func--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.update_weights" class="md-nav__link">
    <span class="md-ellipsis">
      update_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="update_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.update_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.update_weights--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.update_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#federated-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Federated Nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node.federated_node" class="md-nav__link">
    <span class="md-ellipsis">
      federated_node
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode" class="md-nav__link">
    <span class="md-ellipsis">
      FederatedNode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FederatedNode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.connect_data_id" class="md-nav__link">
    <span class="md-ellipsis">
      connect_data_id
    </span>
  </a>
  
    <nav class="md-nav" aria-label="connect_data_id">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.connect_data_id--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.get_weights" class="md-nav__link">
    <span class="md-ellipsis">
      get_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.local_training" class="md-nav__link">
    <span class="md-ellipsis">
      local_training
    </span>
  </a>
  
    <nav class="md-nav" aria-label="local_training">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.local_training--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.local_training--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.train_local_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_local_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="train_local_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.train_local_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.train_local_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.update_weights" class="md-nav__link">
    <span class="md-ellipsis">
      update_weights
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      aggregator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights" class="md-nav__link">
    <span class="md-ellipsis">
      aggregate_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="aggregate_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      fedopt_aggregator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer" class="md-nav__link">
    <span class="md-ellipsis">
      Fedopt_Optimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fedopt_Optimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights" class="md-nav__link">
    <span class="md-ellipsis">
      optimize_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="optimize_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulations" class="md-nav__link">
    <span class="md-ellipsis">
      Simulations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation.simulation" class="md-nav__link">
    <span class="md-ellipsis">
      simulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.__init__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_node_model" class="md-nav__link">
    <span class="md-ellipsis">
      attach_node_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_node_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_node_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_orchestrator_model" class="md-nav__link">
    <span class="md-ellipsis">
      attach_orchestrator_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_orchestrator_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_orchestrator_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_orchestrator_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.train_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      train_epoch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="train_epoch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.train_epoch--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.train_epoch--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.training_protocol" class="md-nav__link">
    <span class="md-ellipsis">
      training_protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="training_protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.training_protocol--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.training_protocol--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      adaptive_optimizer_simulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Adaptive_Optimizer_Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adaptive_Optimizer_Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation.training_protocol" class="md-nav__link">
    <span class="md-ellipsis">
      training_protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="training_protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation.training_protocol--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation.training_protocol--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opearations" class="md-nav__link">
    <span class="md-ellipsis">
      Opearations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.evaluations" class="md-nav__link">
    <span class="md-ellipsis">
      evaluations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.evaluations.automatic_node_evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      automatic_node_evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="automatic_node_evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.evaluations.automatic_node_evaluation--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations.evaluations.automatic_node_evaluation--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.evaluations.evaluate_model" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="evaluate_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.evaluations.evaluate_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations.evaluations.evaluate_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.orchestrations" class="md-nav__link">
    <span class="md-ellipsis">
      orchestrations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      sample_nodes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sample_nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_nodes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_nodes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_weighted_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      sample_weighted_nodes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sample_weighted_nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_weighted_nodes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_weighted_nodes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.orchestrations.train_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      train_nodes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="train_nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.train_nodes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators_1" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      aggregator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights" class="md-nav__link">
    <span class="md-ellipsis">
      aggregate_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="aggregate_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      fedopt_aggregator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer" class="md-nav__link">
    <span class="md-ellipsis">
      Fedopt_Optimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fedopt_Optimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights" class="md-nav__link">
    <span class="md-ellipsis">
      optimize_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="optimize_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../explanation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Explanation
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#federated-models" class="md-nav__link">
    <span class="md-ellipsis">
      Federated Models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model.federated_model" class="md-nav__link">
    <span class="md-ellipsis">
      federated_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel" class="md-nav__link">
    <span class="md-ellipsis">
      FederatedModel
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FederatedModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.__init__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.attach_dataset_id" class="md-nav__link">
    <span class="md-ellipsis">
      attach_dataset_id
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_dataset_id">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.attach_dataset_id--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.evaluate_model" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="evaluate_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.evaluate_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.evaluate_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_gradients" class="md-nav__link">
    <span class="md-ellipsis">
      get_gradients
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_gradients">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_gradients--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_gradients--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_gradients--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_weights" class="md-nav__link">
    <span class="md-ellipsis">
      get_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="get_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_weights--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.get_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.preserve_initial_model" class="md-nav__link">
    <span class="md-ellipsis">
      preserve_initial_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="preserve_initial_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.preserve_initial_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.preserve_initial_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.store_model_on_disk" class="md-nav__link">
    <span class="md-ellipsis">
      store_model_on_disk
    </span>
  </a>
  
    <nav class="md-nav" aria-label="store_model_on_disk">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.store_model_on_disk--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns:
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.store_model_on_disk--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.train" class="md-nav__link">
    <span class="md-ellipsis">
      train
    </span>
  </a>
  
    <nav class="md-nav" aria-label="train">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.train--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.train--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.transform_func" class="md-nav__link">
    <span class="md-ellipsis">
      transform_func
    </span>
  </a>
  
    <nav class="md-nav" aria-label="transform_func">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.transform_func--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.update_weights" class="md-nav__link">
    <span class="md-ellipsis">
      update_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="update_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.update_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.update_weights--raises" class="md-nav__link">
    <span class="md-ellipsis">
      Raises
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#model.federated_model.FederatedModel.update_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#federated-nodes" class="md-nav__link">
    <span class="md-ellipsis">
      Federated Nodes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node.federated_node" class="md-nav__link">
    <span class="md-ellipsis">
      federated_node
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode" class="md-nav__link">
    <span class="md-ellipsis">
      FederatedNode
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FederatedNode">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.connect_data_id" class="md-nav__link">
    <span class="md-ellipsis">
      connect_data_id
    </span>
  </a>
  
    <nav class="md-nav" aria-label="connect_data_id">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.connect_data_id--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.get_weights" class="md-nav__link">
    <span class="md-ellipsis">
      get_weights
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.local_training" class="md-nav__link">
    <span class="md-ellipsis">
      local_training
    </span>
  </a>
  
    <nav class="md-nav" aria-label="local_training">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.local_training--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.local_training--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.train_local_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_local_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="train_local_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.train_local_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.train_local_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#node.federated_node.FederatedNode.update_weights" class="md-nav__link">
    <span class="md-ellipsis">
      update_weights
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      aggregator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights" class="md-nav__link">
    <span class="md-ellipsis">
      aggregate_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="aggregate_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      fedopt_aggregator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer" class="md-nav__link">
    <span class="md-ellipsis">
      Fedopt_Optimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fedopt_Optimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights" class="md-nav__link">
    <span class="md-ellipsis">
      optimize_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="optimize_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulations" class="md-nav__link">
    <span class="md-ellipsis">
      Simulations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation.simulation" class="md-nav__link">
    <span class="md-ellipsis">
      simulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
    <nav class="md-nav" aria-label="__init__">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.__init__--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.__init__--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_node_model" class="md-nav__link">
    <span class="md-ellipsis">
      attach_node_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_node_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_node_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_orchestrator_model" class="md-nav__link">
    <span class="md-ellipsis">
      attach_orchestrator_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="attach_orchestrator_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_orchestrator_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.attach_orchestrator_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.train_epoch" class="md-nav__link">
    <span class="md-ellipsis">
      train_epoch
    </span>
  </a>
  
    <nav class="md-nav" aria-label="train_epoch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.train_epoch--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.train_epoch--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.training_protocol" class="md-nav__link">
    <span class="md-ellipsis">
      training_protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="training_protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.training_protocol--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.simulation.Simulation.training_protocol--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      adaptive_optimizer_simulation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation" class="md-nav__link">
    <span class="md-ellipsis">
      Adaptive_Optimizer_Simulation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Adaptive_Optimizer_Simulation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation.training_protocol" class="md-nav__link">
    <span class="md-ellipsis">
      training_protocol
    </span>
  </a>
  
    <nav class="md-nav" aria-label="training_protocol">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation.training_protocol--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation.training_protocol--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opearations" class="md-nav__link">
    <span class="md-ellipsis">
      Opearations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.evaluations" class="md-nav__link">
    <span class="md-ellipsis">
      evaluations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.evaluations.automatic_node_evaluation" class="md-nav__link">
    <span class="md-ellipsis">
      automatic_node_evaluation
    </span>
  </a>
  
    <nav class="md-nav" aria-label="automatic_node_evaluation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.evaluations.automatic_node_evaluation--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations.evaluations.automatic_node_evaluation--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.evaluations.evaluate_model" class="md-nav__link">
    <span class="md-ellipsis">
      evaluate_model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="evaluate_model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.evaluations.evaluate_model--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations.evaluations.evaluate_model--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.orchestrations" class="md-nav__link">
    <span class="md-ellipsis">
      orchestrations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      sample_nodes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sample_nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_nodes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_nodes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_weighted_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      sample_weighted_nodes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="sample_weighted_nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_weighted_nodes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.sample_weighted_nodes--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operations.orchestrations.train_nodes" class="md-nav__link">
    <span class="md-ellipsis">
      train_nodes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="train_nodes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operations.orchestrations.train_nodes--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators_1" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregators
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      aggregator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      Aggregator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aggregator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights" class="md-nav__link">
    <span class="md-ellipsis">
      aggregate_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="aggregate_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.aggregator.Aggregator.aggregate_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator" class="md-nav__link">
    <span class="md-ellipsis">
      fedopt_aggregator
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer" class="md-nav__link">
    <span class="md-ellipsis">
      Fedopt_Optimizer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Fedopt_Optimizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer--attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights" class="md-nav__link">
    <span class="md-ellipsis">
      optimize_weights
    </span>
  </a>
  
    <nav class="md-nav" aria-label="optimize_weights">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Reference</h1>

<h2 id="federated-models">Federated Models</h2>
<p>A boilerplate code for creating Federated Model</p>


<div class="doc doc-object doc-module">



<a id="model.federated_model"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="model.federated_model.FederatedModel" class="doc doc-heading">
            <code>FederatedModel</code>


</h2>


    <div class="doc doc-contents ">


      <p>This class is used to encapsulate the (PyTorch) federated model that
we will train. It accepts only the PyTorch models and 
provides a utility functions to initialize the model, 
retrieve the weights or perform an indicated number of traning
epochs.</p>

              <details class="quote">
                <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FederatedModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class is used to encapsulate the (PyTorch) federated model that</span>
<span class="sd">    we will train. It accepts only the PyTorch models and </span>
<span class="sd">    provides a utility functions to initialize the model, </span>
<span class="sd">    retrieve the weights or perform an indicated number of traning</span>
<span class="sd">    epochs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">net</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
        <span class="n">optimizer_template</span><span class="p">:</span> <span class="n">partial</span><span class="p">,</span>
        <span class="n">loader_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">force_cpu</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Federated Model. This model will be attached to a </span>
<span class="sd">        specific client and will wait for further instructionss</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        net: nn.Module </span>
<span class="sd">            The Neural Network architecture that we want to use.</span>
<span class="sd">        optimizer_template: functools.partial</span>
<span class="sd">            The partial function of the optimizer that will be used as a template</span>
<span class="sd">        node_name: int | str</span>
<span class="sd">            The name of the node</span>
<span class="sd">        loader_batch_size: int</span>
<span class="sd">            Batch size of the trainloader and testloader.</span>
<span class="sd">        force_gpu: bool = False</span>
<span class="sd">            Option to force the calculations on cpu even if the gpu is available.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Primary computation device: GPU or CPU</span>
        <span class="k">if</span> <span class="n">force_cpu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

        <span class="c1"># Second computaiton device to offload parameters: CPU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="kc">None</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">loader_batch_size</span>
        <span class="c1"># List containing all the parameters to update</span>
        <span class="n">params_to_update</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">params_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer_template</span><span class="p">(</span><span class="n">params_to_update</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">attach_dataset_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">local_dataset</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">datasets</span><span class="o">.</span><span class="n">arrow_dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">datasets</span><span class="o">.</span><span class="n">arrow_dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">datasets</span><span class="o">.</span><span class="n">arrow_dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span>
        <span class="n">node_name</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">only_test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">hugging_face_map</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attaches huggingface dataset to the model by firstly converting it into a pytorch-appropiate standard.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        local_dataset: list[datasets.arrow_dataset.Dataset] </span>
<span class="sd">            A local dataset that should be loaded into DataLoader</span>
<span class="sd">        node_name: int | str</span>
<span class="sd">            The name of the node attributed to particular dataset</span>
<span class="sd">        only_test: bool [default to False]: </span>
<span class="sd">            If true, only a test set will be returned</span>
<span class="sd">        batch_size: int [default to 32]:</span>
<span class="sd">            Batch size used in test and train loader</span>
<span class="sd">        higging_face_map: bool [default to True]:</span>
<span class="sd">            If set to True, will use hugging face map function,</span>
<span class="sd">            that takes more time to process but results in a more</span>
<span class="sd">            stable and reversable transformation of the results.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">node_name</span>
        <span class="k">if</span> <span class="n">only_test</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hugging_face_map</span><span class="p">:</span>
                <span class="n">convert_tensor</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sample</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">convert_tensor</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">])})</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_format</span><span class="p">(</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">output_all_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sample</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">convert_tensor</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">])})</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_format</span><span class="p">(</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">output_all_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">with_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span><span class="p">)</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">with_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trainloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
                <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
                <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hugging_face_map</span><span class="p">:</span>
                <span class="n">convert_tensor</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sample</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">convert_tensor</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">])})</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_format</span><span class="p">(</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">output_all_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">with_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">testloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
                <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
                <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>


    <span class="c1"># def print_model_footprint(self) -&gt; None:</span>
    <span class="c1">#     &quot;&quot;&quot;Prints all the information about the model..</span>
    <span class="c1">#     Args:</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     unique_hash = hash(next(iter(self.trainloader))[&#39;image&#39;] + self.node_name)</span>

    <span class="c1">#     string = f&quot;&quot;&quot;</span>
    <span class="c1">#     model id: {self.node_name}</span>
    <span class="c1">#     device: {self.device},</span>
    <span class="c1">#     optimizer: {self.optimizer},</span>
    <span class="c1">#     unique hash: {unique_hash}</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     return (self.node_name, self.device, self.optimizer, unique_hash)</span>

    <span class="c1">#     # num_examples = {</span>
    <span class="c1">#     #     &quot;trainset&quot;: len(self.training_set),</span>
    <span class="c1">#     #     &quot;testset&quot;: len(self.test_set),</span>
    <span class="c1">#     # }</span>
    <span class="c1">#     # targets = []</span>
    <span class="c1">#     # for _, data in enumerate(trainloader, 0):</span>
    <span class="c1">#     #     targets.append(data[1])</span>
    <span class="c1">#     # targets = [item.item() for sublist in targets for item in sublist]</span>
    <span class="c1">#     # model_logger.info(f&quot;{self.node_name}, {Counter(targets)}&quot;)</span>
    <span class="c1">#     # model_logger.info(f&quot;{self.node_name}: Training set size: {num_examples[&#39;trainset&#39;]}&quot;)</span>
    <span class="c1">#     # model_logger.info(f&quot;{self.node_name}: Test set size: {num_examples[&#39;testset&#39;]}&quot;)</span>


    <span class="c1"># def get_weights_list(self) -&gt; list[float]:</span>
    <span class="c1">#     &quot;&quot;&quot;Get the parameters of the network.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#     List[float]: parameters of the network</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     return [val.cpu().numpy() for _, val in self.net.state_dict().items()]</span>


    <span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the weights of the network.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Raises</span>
<span class="sd">        -------------</span>
<span class="sd">            Exception: if the model is not initialized it raises an exception.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------------</span>
<span class="sd">            _type_: weights of the network</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span> <span class="c1"># Dupming weights on cpu.</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>


    <span class="k">def</span> <span class="nf">get_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the gradients of the network (differences between received and trained model)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Raises</span>
<span class="sd">        -------------</span>
<span class="sd">            Exception: if the original model was not preserved.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------------</span>
<span class="sd">            Oredered_Dict: Gradients of the network.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Computing gradients require saving initial model first!&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span> <span class="c1"># Dupming weights on cpu.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span>
        <span class="n">weights_trained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
        <span class="n">weights_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gradients</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">weights_trained</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights_trained</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gradients</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span>  <span class="n">weights_trained</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">weights_initial</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradients</span> <span class="c1"># Try: to provide original weights, no copies</span>


    <span class="k">def</span> <span class="nf">update_weights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">avg_tensors</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Updates the weights of the network stored on client with passed tensors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        avg_tensors: Ordered_Dict</span>
<span class="sd">            An Ordered Dictionary containing a averaged tensors</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        Exception: _description_</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">avg_tensors</span><span class="p">),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">store_model_on_disk</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Saves local model in a .pt format.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        Iteration: int</span>
<span class="sd">            Current iteration</span>
<span class="sd">        Path: str</span>
<span class="sd">            Path to the saved repository</span>

<span class="sd">        Returns: </span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Raises</span>
<span class="sd">        -------</span>
<span class="sd">            Exception if the model is not initialized it raises an exception</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;node_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="si">}</span><span class="s2">_iteration_</span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">.pt&quot;</span>
        <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
            <span class="n">save_path</span><span class="p">,</span>
        <span class="p">)</span>


    <span class="k">def</span> <span class="nf">preserve_initial_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Preserve the initial model provided at the</span>
<span class="sd">        end of the turn (necessary for computing gradients,</span>
<span class="sd">        when using aggregating methods such as FedOpt).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Tuple[float, float]: Loss and accuracy on the training set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Train the network and computes loss and accuracy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iterations: int </span>
<span class="sd">            Current iteration</span>
<span class="sd">        epoch: int</span>
<span class="sd">            Current (local) epoch</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
        <span class="n">train_loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># Try: to place a net on the device during the training stage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainloader</span><span class="p">):</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span> <span class="c1"># Zero grading the network                        </span>
            <span class="c1"># forward pass, backward pass and optimization</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
            <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
            <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

            <span class="n">train_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">targets</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">correct</span> <span class="o">+=</span> <span class="n">predicted</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

            <span class="c1"># Emptying the cuda_cache</span>
            <span class="c1"># if torch.cuda.is_available():</span>
            <span class="c1">#     torch.cuda.empty_cache()</span>

        <span class="n">loss</span> <span class="o">=</span> <span class="n">train_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainloader</span><span class="p">)</span>
        <span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span>
        <span class="n">model_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ITERATION </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> | EPOCH </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2"> | NODE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="si">}</span><span class="s2">] Training on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="si">}</span><span class="s2"> results: loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">, accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">loss</span><span class="p">,</span> 
                <span class="n">accuracy</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">evaluate_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate the network on the local test set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Tuple[float, float]: loss and accuracy on the test set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Try: to place net on device directly during the evaluation stage.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
        <span class="n">evaluation_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
        <span class="n">test_loss</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y_true</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testloader</span><span class="p">):</span>
                <span class="n">inputs</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
                <span class="n">targets</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
                <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

                <span class="n">total</span> <span class="o">+=</span> <span class="n">targets</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">test_loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_loss</span><span class="p">)</span>
                <span class="n">pred</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">correct</span> <span class="o">+=</span> <span class="n">pred</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">view_as</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
                <span class="n">y_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
                <span class="n">y_true</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

        <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;test_loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
        <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span>

        <span class="n">y_true</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">y_true</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">y_pred</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

        <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;f1score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>
        <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>
        <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>

        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">accuracy_per_class</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
        <span class="n">accuracy_per_class_expanded</span> <span class="o">=</span> <span class="p">{</span>
            <span class="sa">f</span><span class="s1">&#39;accuracy_per_</span><span class="si">{</span><span class="n">class_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">class_id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">accuracy_per_class</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">evaluation_results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">accuracy_per_class_expanded</span><span class="p">)</span>

        <span class="c1"># true_positives = np.diag(cm)</span>
        <span class="c1"># num_classes = len(list(set(y_true)))</span>

        <span class="c1"># false_positives = []</span>
        <span class="c1"># for i in range(num_classes):</span>
        <span class="c1">#     false_positives.append(sum(cm[:,i]) - cm[i,i])</span>

        <span class="c1"># false_negatives = []</span>
        <span class="c1"># for i in range(num_classes):</span>
        <span class="c1">#     false_negatives.append(sum(cm[i,:]) - cm[i,i])</span>

        <span class="c1"># true_negatives = []</span>
        <span class="c1"># for i in range(num_classes):</span>
        <span class="c1">#     temp = np.delete(cm, i, 0)   # delete ith row</span>
        <span class="c1">#     temp = np.delete(temp, i, 1)  # delete ith column</span>
        <span class="c1">#     true_negatives.append(sum(sum(temp)))</span>

        <span class="c1"># denominator = [sum(x) for x in zip(false_positives, true_negatives)]</span>
        <span class="c1"># false_positive_rate = [num/den for num, den in zip(false_positives, denominator)]</span>

        <span class="c1"># denominator = [sum(x) for x in zip(true_positives, false_negatives)]</span>
        <span class="c1"># true_positive_rate = [num/den for num, den in zip(true_positives, denominator)]</span>

        <span class="c1"># # # Emptying the cuda_cache</span>
        <span class="c1"># # if torch.cuda.is_available():</span>
        <span class="c1"># #     torch.cuda.empty_cache()</span>

        <span class="k">return</span> <span class="n">evaluation_results</span>


    <span class="c1"># def quick_evaluate(self) -&gt; tuple[float, float]:</span>
    <span class="c1">#     &quot;&quot;&quot;Quicker version of the evaluate_model(function) </span>
    <span class="c1">#     Validate the network on the local test set returning only the loss and accuracy.</span>

    <span class="c1">#     Parameters</span>
    <span class="c1">#     ----------</span>

    <span class="c1">#     Returns</span>
    <span class="c1">#     -------</span>
    <span class="c1">#         Tuple[float, float]: loss and accuracy on the test set.</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     # Try: to place net on device directly during the evaluation stage.</span>
    <span class="c1">#     self.net.to(self.device)</span>
    <span class="c1">#     criterion = nn.CrossEntropyLoss()</span>
    <span class="c1">#     test_loss = 0</span>
    <span class="c1">#     correct = 0</span>
    <span class="c1">#     total = 0</span>

    <span class="c1">#     with torch.no_grad():</span>
    <span class="c1">#         for _, dic in enumerate(self.testloader):</span>
    <span class="c1">#             inputs = dic[&#39;image&#39;]</span>
    <span class="c1">#             targets = dic[&#39;label&#39;]</span>
    <span class="c1">#             inputs, targets = inputs.to(self.device), targets.to(self.device)</span>
    <span class="c1">#             outputs = self.net(inputs)</span>
    <span class="c1">#             loss = criterion(outputs, targets)</span>

    <span class="c1">#             test_loss += loss.item()</span>
    <span class="c1">#             _, predicted = outputs.max(1)</span>
    <span class="c1">#             total += targets.size(0)</span>
    <span class="c1">#             correct += predicted.eq(targets).sum().item()</span>

    <span class="c1">#     test_loss = test_loss / len(self.testloader)</span>
    <span class="c1">#     accuracy = correct / total</span>

    <span class="c1">#     # # Emptying the cuda_cache</span>
    <span class="c1">#     # if torch.cuda.is_available():</span>
    <span class="c1">#     #     torch.cuda.empty_cache()</span>

    <span class="c1">#     return (</span>
    <span class="c1">#         test_loss,</span>
    <span class="c1">#         accuracy</span>
    <span class="c1">#         )</span>


    <span class="k">def</span> <span class="nf">transform_func</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">arrow_dataset</span><span class="o">.</span><span class="n">Dataset</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Convers datasets.arrow_dataset.Dataset into a PyTorch Tensor</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        local_dataset: datasets.arrow_dataset.Dataset</span>
<span class="sd">            A local dataset that should be loaded into DataLoader</span>
<span class="sd">        only_test: bool [default to False]: </span>
<span class="sd">            If true, only a test set will be returned</span>

<span class="sd">        Returns</span>
<span class="sd">        -------------</span>
<span class="sd">        None&quot;&quot;&quot;</span>
        <span class="n">convert_tensor</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
        <span class="n">data</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_tensor</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">optimizer_template</span><span class="p">,</span> <span class="n">loader_batch_size</span><span class="p">,</span> <span class="n">force_cpu</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Initialize the Federated Model. This model will be attached to a 
specific client and will wait for further instructionss</p>
<h5 id="model.federated_model.FederatedModel.__init__--parameters">Parameters</h5>
<p>net: nn.Module 
    The Neural Network architecture that we want to use.
optimizer_template: functools.partial
    The partial function of the optimizer that will be used as a template
node_name: int | str
    The name of the node
loader_batch_size: int
    Batch size of the trainloader and testloader.
force_gpu: bool = False
    Option to force the calculations on cpu even if the gpu is available.</p>
<h5 id="model.federated_model.FederatedModel.__init__--returns">Returns</h5>
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">net</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">,</span>
    <span class="n">optimizer_template</span><span class="p">:</span> <span class="n">partial</span><span class="p">,</span>
    <span class="n">loader_batch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">force_cpu</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the Federated Model. This model will be attached to a </span>
<span class="sd">    specific client and will wait for further instructionss</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    net: nn.Module </span>
<span class="sd">        The Neural Network architecture that we want to use.</span>
<span class="sd">    optimizer_template: functools.partial</span>
<span class="sd">        The partial function of the optimizer that will be used as a template</span>
<span class="sd">    node_name: int | str</span>
<span class="sd">        The name of the node</span>
<span class="sd">    loader_batch_size: int</span>
<span class="sd">        Batch size of the trainloader and testloader.</span>
<span class="sd">    force_gpu: bool = False</span>
<span class="sd">        Option to force the calculations on cpu even if the gpu is available.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Primary computation device: GPU or CPU</span>
    <span class="k">if</span> <span class="n">force_cpu</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s1">&#39;cpu&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cuda&quot;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

    <span class="c1"># Second computaiton device to offload parameters: CPU</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">device</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="kc">None</span>  
    <span class="bp">self</span><span class="o">.</span><span class="n">net</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">loader_batch_size</span>
    <span class="c1"># List containing all the parameters to update</span>
    <span class="n">params_to_update</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">params_to_update</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer_template</span><span class="p">(</span><span class="n">params_to_update</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.attach_dataset_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_dataset_id</span><span class="p">(</span><span class="n">local_dataset</span><span class="p">,</span> <span class="n">node_name</span><span class="p">,</span> <span class="n">only_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hugging_face_map</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Attaches huggingface dataset to the model by firstly converting it into a pytorch-appropiate standard.</p>
<h5 id="model.federated_model.FederatedModel.attach_dataset_id--parameters">Parameters</h5>
<p>local_dataset: list[datasets.arrow_dataset.Dataset] 
    A local dataset that should be loaded into DataLoader
node_name: int | str
    The name of the node attributed to particular dataset
only_test: bool [default to False]: 
    If true, only a test set will be returned
batch_size: int [default to 32]:
    Batch size used in test and train loader
higging_face_map: bool [default to True]:
    If set to True, will use hugging face map function,
    that takes more time to process but results in a more
    stable and reversable transformation of the results.
Returns</p>
<hr />
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">attach_dataset_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">local_dataset</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">datasets</span><span class="o">.</span><span class="n">arrow_dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">datasets</span><span class="o">.</span><span class="n">arrow_dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">]</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="n">datasets</span><span class="o">.</span><span class="n">arrow_dataset</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span>
    <span class="n">node_name</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">only_test</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">hugging_face_map</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Attaches huggingface dataset to the model by firstly converting it into a pytorch-appropiate standard.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    local_dataset: list[datasets.arrow_dataset.Dataset] </span>
<span class="sd">        A local dataset that should be loaded into DataLoader</span>
<span class="sd">    node_name: int | str</span>
<span class="sd">        The name of the node attributed to particular dataset</span>
<span class="sd">    only_test: bool [default to False]: </span>
<span class="sd">        If true, only a test set will be returned</span>
<span class="sd">    batch_size: int [default to 32]:</span>
<span class="sd">        Batch size used in test and train loader</span>
<span class="sd">    higging_face_map: bool [default to True]:</span>
<span class="sd">        If set to True, will use hugging face map function,</span>
<span class="sd">        that takes more time to process but results in a more</span>
<span class="sd">        stable and reversable transformation of the results.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_name</span> <span class="o">=</span> <span class="n">node_name</span>
    <span class="k">if</span> <span class="n">only_test</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hugging_face_map</span><span class="p">:</span>
            <span class="n">convert_tensor</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sample</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">convert_tensor</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">])})</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_format</span><span class="p">(</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">output_all_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sample</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">convert_tensor</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">])})</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_format</span><span class="p">(</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">output_all_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">with_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span><span class="p">)</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">with_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trainloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hugging_face_map</span><span class="p">:</span>
            <span class="n">convert_tensor</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sample</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;image&quot;</span><span class="p">:</span> <span class="n">convert_tensor</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">])})</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_format</span><span class="p">(</span><span class="s2">&quot;pt&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">],</span> <span class="n">output_all_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">with_transform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transform_func</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testloader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">local_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">num_workers</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.evaluate_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate_model</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Validate the network on the local test set.</p>
<h5 id="model.federated_model.FederatedModel.evaluate_model--parameters">Parameters</h5>
<h5 id="model.federated_model.FederatedModel.evaluate_model--returns">Returns</h5>
<pre><code>Tuple[float, float]: loss and accuracy on the test set.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate the network on the local test set.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        Tuple[float, float]: loss and accuracy on the test set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Try: to place net on device directly during the evaluation stage.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
    <span class="n">evaluation_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
    <span class="n">test_loss</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">y_true</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">losses</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">testloader</span><span class="p">):</span>
            <span class="n">inputs</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
            <span class="n">targets</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
            <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>

            <span class="n">total</span> <span class="o">+=</span> <span class="n">targets</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">test_loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">losses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_loss</span><span class="p">)</span>
            <span class="n">pred</span> <span class="o">=</span> <span class="n">output</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">correct</span> <span class="o">+=</span> <span class="n">pred</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">targets</span><span class="o">.</span><span class="n">view_as</span><span class="p">(</span><span class="n">pred</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
            <span class="n">y_pred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
            <span class="n">y_true</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span>

    <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;test_loss&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">losses</span><span class="p">)</span>
    <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;accuracy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span>

    <span class="n">y_true</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">y_true</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">y_pred</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>

    <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;f1score&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>
    <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;precision&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">precision_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>
    <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;recall&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">recall_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s2">&quot;macro&quot;</span><span class="p">)</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)])</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">cm</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
    <span class="n">accuracy_per_class</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">diagonal</span><span class="p">()</span>
    <span class="n">accuracy_per_class_expanded</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sa">f</span><span class="s1">&#39;accuracy_per_</span><span class="si">{</span><span class="n">class_id</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">class_id</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">accuracy_per_class</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">evaluation_results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">accuracy_per_class_expanded</span><span class="p">)</span>

    <span class="c1"># true_positives = np.diag(cm)</span>
    <span class="c1"># num_classes = len(list(set(y_true)))</span>

    <span class="c1"># false_positives = []</span>
    <span class="c1"># for i in range(num_classes):</span>
    <span class="c1">#     false_positives.append(sum(cm[:,i]) - cm[i,i])</span>

    <span class="c1"># false_negatives = []</span>
    <span class="c1"># for i in range(num_classes):</span>
    <span class="c1">#     false_negatives.append(sum(cm[i,:]) - cm[i,i])</span>

    <span class="c1"># true_negatives = []</span>
    <span class="c1"># for i in range(num_classes):</span>
    <span class="c1">#     temp = np.delete(cm, i, 0)   # delete ith row</span>
    <span class="c1">#     temp = np.delete(temp, i, 1)  # delete ith column</span>
    <span class="c1">#     true_negatives.append(sum(sum(temp)))</span>

    <span class="c1"># denominator = [sum(x) for x in zip(false_positives, true_negatives)]</span>
    <span class="c1"># false_positive_rate = [num/den for num, den in zip(false_positives, denominator)]</span>

    <span class="c1"># denominator = [sum(x) for x in zip(true_positives, false_negatives)]</span>
    <span class="c1"># true_positive_rate = [num/den for num, den in zip(true_positives, denominator)]</span>

    <span class="c1"># # # Emptying the cuda_cache</span>
    <span class="c1"># # if torch.cuda.is_available():</span>
    <span class="c1"># #     torch.cuda.empty_cache()</span>

    <span class="k">return</span> <span class="n">evaluation_results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.get_gradients" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_gradients</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Get the gradients of the network (differences between received and trained model)</p>
<h5 id="model.federated_model.FederatedModel.get_gradients--parameters">Parameters</h5>
<h5 id="model.federated_model.FederatedModel.get_gradients--raises">Raises</h5>
<pre><code>Exception: if the original model was not preserved.
</code></pre>
<h5 id="model.federated_model.FederatedModel.get_gradients--returns">Returns</h5>
<pre><code>Oredered_Dict: Gradients of the network.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_gradients</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the gradients of the network (differences between received and trained model)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Raises</span>
<span class="sd">    -------------</span>
<span class="sd">        Exception: if the original model was not preserved.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        Oredered_Dict: Gradients of the network.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Computing gradients require saving initial model first!&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span> <span class="c1"># Dupming weights on cpu.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span>
    <span class="n">weights_trained</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>
    <span class="n">weights_initial</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">gradients</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">weights_trained</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights_trained</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gradients</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span>  <span class="n">weights_trained</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">weights_initial</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gradients</span> <span class="c1"># Try: to provide original weights, no copies</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.get_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_weights</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Get the weights of the network.</p>
<h5 id="model.federated_model.FederatedModel.get_weights--parameters">Parameters</h5>
<h5 id="model.federated_model.FederatedModel.get_weights--raises">Raises</h5>
<pre><code>Exception: if the model is not initialized it raises an exception.
</code></pre>
<h5 id="model.federated_model.FederatedModel.get_weights--returns">Returns</h5>
<pre><code>_type_: weights of the network
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the weights of the network.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Raises</span>
<span class="sd">    -------------</span>
<span class="sd">        Exception: if the model is not initialized it raises an exception.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">        _type_: weights of the network</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span> <span class="c1"># Dupming weights on cpu.</span>
    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">state_dict</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.preserve_initial_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preserve_initial_model</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Preserve the initial model provided at the
end of the turn (necessary for computing gradients,
when using aggregating methods such as FedOpt).</p>
<h5 id="model.federated_model.FederatedModel.preserve_initial_model--parameters">Parameters</h5>
<h5 id="model.federated_model.FederatedModel.preserve_initial_model--returns">Returns</h5>
<pre><code>Tuple[float, float]: Loss and accuracy on the training set.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">preserve_initial_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Preserve the initial model provided at the</span>
<span class="sd">    end of the turn (necessary for computing gradients,</span>
<span class="sd">    when using aggregating methods such as FedOpt).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        Tuple[float, float]: Loss and accuracy on the training set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">initial_model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.store_model_on_disk" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">store_model_on_disk</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Saves local model in a .pt format.
Parameters</p>
<hr />
<p>Iteration: int
    Current iteration
Path: str
    Path to the saved repository</p>
<h5 id="model.federated_model.FederatedModel.store_model_on_disk--returns">Returns:</h5>
<p>None</p>
<h5 id="model.federated_model.FederatedModel.store_model_on_disk--raises">Raises</h5>
<pre><code>Exception if the model is not initialized it raises an exception
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">store_model_on_disk</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves local model in a .pt format.</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Iteration: int</span>
<span class="sd">        Current iteration</span>
<span class="sd">    Path: str</span>
<span class="sd">        Path to the saved repository</span>

<span class="sd">    Returns: </span>
<span class="sd">    -------</span>
<span class="sd">    None</span>

<span class="sd">    Raises</span>
<span class="sd">    -------</span>
<span class="sd">        Exception if the model is not initialized it raises an exception</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;node_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="si">}</span><span class="s2">_iteration_</span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">.pt&quot;</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">state_dict</span><span class="p">(),</span>
        <span class="n">save_path</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.train" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Train the network and computes loss and accuracy.</p>
<h5 id="model.federated_model.FederatedModel.train--parameters">Parameters</h5>
<p>iterations: int 
    Current iteration
epoch: int
    Current (local) epoch</p>
<h5 id="model.federated_model.FederatedModel.train--returns">Returns</h5>
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Train the network and computes loss and accuracy.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iterations: int </span>
<span class="sd">        Current iteration</span>
<span class="sd">    epoch: int</span>
<span class="sd">        Current (local) epoch</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">CrossEntropyLoss</span><span class="p">()</span>
    <span class="n">train_loss</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">correct</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># Try: to place a net on the device during the training stage</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainloader</span><span class="p">):</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">dic</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span>
        <span class="n">inputs</span><span class="p">,</span> <span class="n">targets</span> <span class="o">=</span> <span class="n">inputs</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="n">targets</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span> <span class="c1"># Zero grading the network                        </span>
        <span class="c1"># forward pass, backward pass and optimization</span>
        <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">outputs</span><span class="p">,</span> <span class="n">targets</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="n">train_loss</span> <span class="o">+=</span> <span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">predicted</span> <span class="o">=</span> <span class="n">outputs</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">total</span> <span class="o">+=</span> <span class="n">targets</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">correct</span> <span class="o">+=</span> <span class="n">predicted</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">targets</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

        <span class="c1"># Emptying the cuda_cache</span>
        <span class="c1"># if torch.cuda.is_available():</span>
        <span class="c1">#     torch.cuda.empty_cache()</span>

    <span class="n">loss</span> <span class="o">=</span> <span class="n">train_loss</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trainloader</span><span class="p">)</span>
    <span class="n">accuracy</span> <span class="o">=</span> <span class="n">correct</span> <span class="o">/</span> <span class="n">total</span>
    <span class="n">model_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ITERATION </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> | EPOCH </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2"> | NODE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="si">}</span><span class="s2">] Training on </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_name</span><span class="si">}</span><span class="s2"> results: loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">, accuracy: </span><span class="si">{</span><span class="n">accuracy</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">loss</span><span class="p">,</span> 
            <span class="n">accuracy</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.transform_func" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">transform_func</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Convers datasets.arrow_dataset.Dataset into a PyTorch Tensor
Parameters</p>
<hr />
<p>local_dataset: datasets.arrow_dataset.Dataset
    A local dataset that should be loaded into DataLoader
only_test: bool [default to False]: 
    If true, only a test set will be returned</p>
<h5 id="model.federated_model.FederatedModel.transform_func--returns">Returns</h5>
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">transform_func</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">datasets</span><span class="o">.</span><span class="n">arrow_dataset</span><span class="o">.</span><span class="n">Dataset</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Convers datasets.arrow_dataset.Dataset into a PyTorch Tensor</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    local_dataset: datasets.arrow_dataset.Dataset</span>
<span class="sd">        A local dataset that should be loaded into DataLoader</span>
<span class="sd">    only_test: bool [default to False]: </span>
<span class="sd">        If true, only a test set will be returned</span>

<span class="sd">    Returns</span>
<span class="sd">    -------------</span>
<span class="sd">    None&quot;&quot;&quot;</span>
    <span class="n">convert_tensor</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">convert_tensor</span><span class="p">(</span><span class="n">img</span><span class="p">)</span> <span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;image&#39;</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="model.federated_model.FederatedModel.update_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_weights</span><span class="p">(</span><span class="n">avg_tensors</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Updates the weights of the network stored on client with passed tensors.</p>
<h5 id="model.federated_model.FederatedModel.update_weights--parameters">Parameters</h5>
<p>avg_tensors: Ordered_Dict
    An Ordered Dictionary containing a averaged tensors</p>
<h5 id="model.federated_model.FederatedModel.update_weights--raises">Raises</h5>
<p>Exception: <em>description</em></p>
<h5 id="model.federated_model.FederatedModel.update_weights--returns">Returns</h5>
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\model\federated_model.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_weights</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> 
    <span class="n">avg_tensors</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates the weights of the network stored on client with passed tensors.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    avg_tensors: Ordered_Dict</span>
<span class="sd">        An Ordered Dictionary containing a averaged tensors</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    Exception: _description_</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">load_state_dict</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">avg_tensors</span><span class="p">),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="federated-nodes">Federated Nodes</h2>
<p>A boilerplate code for creating Federated Node</p>


<div class="doc doc-object doc-module">



<a id="node.federated_node"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="node.federated_node.FederatedNode" class="doc doc-heading">
            <code>FederatedNode</code>


</h2>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>FedJust\node\federated_node.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FederatedNode</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;An abstract object representing a single node in the federated training.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span> <span class="nf">connect_data_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">node_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model</span><span class="p">:</span> <span class="n">FederatedModel</span><span class="p">,</span>
        <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">orchestrator</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attaches dataset and id to a node, creating an individualised version.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node_id: int | str</span>
<span class="sd">            ID of the node</span>
<span class="sd">        model: FederatedModel</span>
<span class="sd">            FederatedModel template that should be copied and attached to the node</span>
<span class="sd">        data: Any</span>
<span class="sd">            Data to be attached to a FederatedModel.</span>
<span class="sd">        orchestrator: bool (default to False)</span>
<span class="sd">            Boolean flag if the node is belonging to the orchestrator</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">node_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">attach_dataset_id</span><span class="p">(</span>
            <span class="n">local_dataset</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">node_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span>
            <span class="n">only_test</span><span class="o">=</span><span class="n">orchestrator</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extended API call to recover model weights. Causes the same effect as calling</span>
<span class="sd">        node.model.get_weigts()</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        None</span>
<span class="sd">        Returns</span>
<span class="sd">        OrderedDict</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">update_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">weights</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extended API call to update model. Causes the same effect as calling</span>
<span class="sd">        node.model.update_weights()</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weights:OrderedDict</span>
<span class="sd">            OrderedDict to be uploaded onto the model.</span>
<span class="sd">        Returns</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">train_local_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">local_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;weights&#39;</span><span class="p">,</span>
                          <span class="n">save_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This function starts the server phase of the federated learning.</span>
<span class="sd">        In particular, it trains the model locally and then sends the weights.</span>
<span class="sd">        Then the updated weights are received and used to update</span>
<span class="sd">        the global model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        node: FederatedNode </span>
<span class="sd">            Node that we want to train.</span>
<span class="sd">        iteration: int</span>
<span class="sd">            Current global iteration</span>
<span class="sd">        local_epochs: int</span>
<span class="sd">            Number of local epochs for which the node should be training.</span>
<span class="sd">        mode: str (default to &#39;weights&#39;)</span>
<span class="sd">            Mode = &#39;weights&#39;: Node will return model&#39;s weights.</span>
<span class="sd">            Mode = &#39;gradients&#39;: Node will return model&#39;s gradients.</span>
<span class="sd">        save_model: bool (default to False)</span>
<span class="sd">            Boolean flag to save a model.</span>
<span class="sd">        save_path: str (defualt to None)</span>
<span class="sd">            Path object used to save a model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            Tuple[int, OrderedDict, List[float], List[float]]:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ITERATION </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> | NODE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2">] Starting training on node </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">loss_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">accuracy_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># If mode is set to &quot;gradients&quot; -&gt; preserve a local model to calculate gradients</span>
        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;gradients&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">preserve_initial_model</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">local_epochs</span><span class="p">):</span>
            <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_training</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span> 
                <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span>
                <span class="p">)</span>
            <span class="n">loss_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">])</span>
            <span class="n">accuracy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">save_model</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">store_model_on_disk</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span> 
                <span class="n">path</span><span class="o">=</span><span class="n">save_path</span>
                <span class="p">)</span>
        <span class="n">node_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ITERATION </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> | NODE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2">] Results of training on node </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">accuracy_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;weights&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_weights</span><span class="p">(),</span>
                <span class="n">loss_list</span><span class="p">,</span>
                <span class="n">accuracy_list</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;gradients&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_gradients</span><span class="p">(),</span>
                <span class="n">loss_list</span><span class="p">,</span>
                <span class="n">accuracy_list</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NameError</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">local_training</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                       <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method for performing one epoch of local training.</span>
<span class="sd">        Performs one round of Federated Training and pack the</span>
<span class="sd">        results (metrics) into the appropiate data structure.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">            dict[int, int]: metrics from the training.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">loss</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="node.federated_node.FederatedNode.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>An abstract object representing a single node in the federated training.</p>
<h5 id="node.federated_node.FederatedNode.__init__--parameters">Parameters</h5>
<p>None
Returns</p>
<hr />
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\node\federated_node.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;An abstract object representing a single node in the federated training.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    None</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="node.federated_node.FederatedNode.connect_data_id" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect_data_id</span><span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">orchestrator</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Attaches dataset and id to a node, creating an individualised version.</p>
<h5 id="node.federated_node.FederatedNode.connect_data_id--parameters">Parameters</h5>
<p>node_id: int | str
    ID of the node
model: FederatedModel
    FederatedModel template that should be copied and attached to the node
data: Any
    Data to be attached to a FederatedModel.
orchestrator: bool (default to False)
    Boolean flag if the node is belonging to the orchestrator
Returns</p>
<hr />
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\node\federated_node.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">connect_data_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">node_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">FederatedModel</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">orchestrator</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Attaches dataset and id to a node, creating an individualised version.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    node_id: int | str</span>
<span class="sd">        ID of the node</span>
<span class="sd">    model: FederatedModel</span>
<span class="sd">        FederatedModel template that should be copied and attached to the node</span>
<span class="sd">    data: Any</span>
<span class="sd">        Data to be attached to a FederatedModel.</span>
<span class="sd">    orchestrator: bool (default to False)</span>
<span class="sd">        Boolean flag if the node is belonging to the orchestrator</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">node_id</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">attach_dataset_id</span><span class="p">(</span>
        <span class="n">local_dataset</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
        <span class="n">node_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span>
        <span class="n">only_test</span><span class="o">=</span><span class="n">orchestrator</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="node.federated_node.FederatedNode.get_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_weights</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Extended API call to recover model weights. Causes the same effect as calling
node.model.get_weigts()
Parameters</p>
<hr />
<p>None
Returns
OrderedDict
None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\node\federated_node.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extended API call to recover model weights. Causes the same effect as calling</span>
<span class="sd">    node.model.get_weigts()</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    None</span>
<span class="sd">    Returns</span>
<span class="sd">    OrderedDict</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_weights</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="node.federated_node.FederatedNode.local_training" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">local_training</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">epoch</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Helper method for performing one epoch of local training.
Performs one round of Federated Training and pack the
results (metrics) into the appropiate data structure.</p>
<h5 id="node.federated_node.FederatedNode.local_training--parameters">Parameters</h5>
<h5 id="node.federated_node.FederatedNode.local_training--returns">Returns</h5>
<pre><code>dict[int, int]: metrics from the training.
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\node\federated_node.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">local_training</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                   <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method for performing one epoch of local training.</span>
<span class="sd">    Performs one round of Federated Training and pack the</span>
<span class="sd">    results (metrics) into the appropiate data structure.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        dict[int, int]: metrics from the training.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">loss</span><span class="p">,</span> <span class="n">accuracy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="n">loss</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="node.federated_node.FederatedNode.train_local_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_local_model</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">local_epochs</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;weights&#39;</span><span class="p">,</span> <span class="n">save_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>This function starts the server phase of the federated learning.
In particular, it trains the model locally and then sends the weights.
Then the updated weights are received and used to update
the global model.</p>
<h5 id="node.federated_node.FederatedNode.train_local_model--parameters">Parameters</h5>
<p>node: FederatedNode 
    Node that we want to train.
iteration: int
    Current global iteration
local_epochs: int
    Number of local epochs for which the node should be training.
mode: str (default to 'weights')
    Mode = 'weights': Node will return model's weights.
    Mode = 'gradients': Node will return model's gradients.
save_model: bool (default to False)
    Boolean flag to save a model.
save_path: str (defualt to None)
    Path object used to save a model</p>
<h5 id="node.federated_node.FederatedNode.train_local_model--returns">Returns</h5>
<pre><code>Tuple[int, OrderedDict, List[float], List[float]]:
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\node\federated_node.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_local_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                      <span class="n">local_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                      <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;weights&#39;</span><span class="p">,</span>
                      <span class="n">save_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                      <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This function starts the server phase of the federated learning.</span>
<span class="sd">    In particular, it trains the model locally and then sends the weights.</span>
<span class="sd">    Then the updated weights are received and used to update</span>
<span class="sd">    the global model.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    node: FederatedNode </span>
<span class="sd">        Node that we want to train.</span>
<span class="sd">    iteration: int</span>
<span class="sd">        Current global iteration</span>
<span class="sd">    local_epochs: int</span>
<span class="sd">        Number of local epochs for which the node should be training.</span>
<span class="sd">    mode: str (default to &#39;weights&#39;)</span>
<span class="sd">        Mode = &#39;weights&#39;: Node will return model&#39;s weights.</span>
<span class="sd">        Mode = &#39;gradients&#39;: Node will return model&#39;s gradients.</span>
<span class="sd">    save_model: bool (default to False)</span>
<span class="sd">        Boolean flag to save a model.</span>
<span class="sd">    save_path: str (defualt to None)</span>
<span class="sd">        Path object used to save a model</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        Tuple[int, OrderedDict, List[float], List[float]]:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ITERATION </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> | NODE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2">] Starting training on node </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">loss_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">accuracy_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># If mode is set to &quot;gradients&quot; -&gt; preserve a local model to calculate gradients</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;gradients&#39;</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">preserve_initial_model</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">local_epochs</span><span class="p">):</span>
        <span class="n">metrics</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_training</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span> 
            <span class="n">epoch</span><span class="o">=</span><span class="n">epoch</span>
            <span class="p">)</span>
        <span class="n">loss_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">])</span>
        <span class="n">accuracy_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s2">&quot;accuracy&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">save_model</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">store_model_on_disk</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span> 
            <span class="n">path</span><span class="o">=</span><span class="n">save_path</span>
            <span class="p">)</span>
    <span class="n">node_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ITERATION </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2"> | NODE </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2">] Results of training on node </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">accuracy_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;weights&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_weights</span><span class="p">(),</span>
            <span class="n">loss_list</span><span class="p">,</span>
            <span class="n">accuracy_list</span>
            <span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;gradients&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_id</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">get_gradients</span><span class="p">(),</span>
            <span class="n">loss_list</span><span class="p">,</span>
            <span class="n">accuracy_list</span>
            <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NameError</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="node.federated_node.FederatedNode.update_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Extended API call to update model. Causes the same effect as calling
node.model.update_weights()
Parameters</p>
<hr />
<p>weights:OrderedDict
    OrderedDict to be uploaded onto the model.
Returns
None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\node\federated_node.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">weights</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Extended API call to update model. Causes the same effect as calling</span>
<span class="sd">    node.model.update_weights()</span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights:OrderedDict</span>
<span class="sd">        OrderedDict to be uploaded onto the model.</span>
<span class="sd">    Returns</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="aggregators">Aggregators</h2>
<p>Aggregators serve as a boilerplate for merging the weights derived from local models</p>


<div class="doc doc-object doc-module">



<a id="aggregators.aggregator"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aggregators.aggregator.Aggregator" class="doc doc-heading">
            <code>Aggregator</code>


</h2>


    <div class="doc doc-contents ">


      <p>Basic class for all Federated Aggregators</p>

              <details class="quote">
                <summary>Source code in <code>FedJust\aggregators\aggregator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Aggregator</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic class for all Federated Aggregators&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">aggregate_weights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Basic aggregate function (equal to FedAvg) that returns the aggregate version of the</span>
<span class="sd">        weights. Perform deepcopy on the passed parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weights: dict[int: OrderedDict]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict&quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="c1">#Here we could add copy and deepcopy</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregators.aggregator.Aggregator.aggregate_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregate_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Basic aggregate function (equal to FedAvg) that returns the aggregate version of the
weights. Perform deepcopy on the passed parameters.</p>
<h5 id="aggregators.aggregator.Aggregator.aggregate_weights--parameters">Parameters</h5>
<p>weights: dict[int: OrderedDict]</p>
<h5 id="aggregators.aggregator.Aggregator.aggregate_weights--returns">Returns</h5>
<p>OrderedDict</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\aggregators\aggregator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">aggregate_weights</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic aggregate function (equal to FedAvg) that returns the aggregate version of the</span>
<span class="sd">    weights. Perform deepcopy on the passed parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights: dict[int: OrderedDict]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OrderedDict&quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="c1">#Here we could add copy and deepcopy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="aggregators.fedopt_aggregator"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aggregators.fedopt_aggregator.Fedopt_Optimizer" class="doc doc-heading">
            <code>Fedopt_Optimizer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="FedJust.aggregators.aggregator.Aggregator">Aggregator</span></code></p>


      <p>Fedopt Optimizer that performs a generalized 
version of Federated Averaging. Suitable for performing
Federated Optimization based on gradients, with 
verying learning rates.</p>
<h4 id="aggregators.fedopt_aggregator.Fedopt_Optimizer--attributes">Attributes</h4>
<p>None</p>

              <details class="quote">
                <summary>Source code in <code>FedJust\aggregators\fedopt_aggregator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Fedopt_Optimizer</span><span class="p">(</span><span class="n">Aggregator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fedopt Optimizer that performs a generalized </span>
<span class="sd">    version of Federated Averaging. Suitable for performing</span>
<span class="sd">    Federated Optimization based on gradients, with </span>
<span class="sd">    verying learning rates.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">optimize_weights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span><span class="n">OrderedDict</span><span class="p">],</span>
        <span class="n">gradients</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">],</span>
        <span class="n">learning_rate</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;FedOpt Aggregation Function (equal to FedAvg when lr=1.0) that returns the </span>
<span class="sd">        updated version of the weights.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weights: dict[int: OrderedDict]</span>
<span class="sd">            Weights of the previous (central) model.</span>
<span class="sd">        gradients: dict[int: OrderedDict]</span>
<span class="sd">            Gradients (defined as trainedmodel - dispatched model)</span>
<span class="sd">        learning_rate: float</span>
<span class="sd">            Learning rate used to </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict&quot;&quot;&quot;</span>        
        <span class="n">updated_weights</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">zeros</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
            <span class="n">updated_weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradients</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">updated_weights</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">optimize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">gradients</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>FedOpt Aggregation Function (equal to FedAvg when lr=1.0) that returns the 
updated version of the weights.</p>
<h5 id="aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--parameters">Parameters</h5>
<p>weights: dict[int: OrderedDict]
    Weights of the previous (central) model.
gradients: dict[int: OrderedDict]
    Gradients (defined as trainedmodel - dispatched model)
learning_rate: float
    Learning rate used to </p>
<h5 id="aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--returns">Returns</h5>
<p>OrderedDict</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\aggregators\fedopt_aggregator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">optimize_weights</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span><span class="n">OrderedDict</span><span class="p">],</span>
    <span class="n">gradients</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">],</span>
    <span class="n">learning_rate</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FedOpt Aggregation Function (equal to FedAvg when lr=1.0) that returns the </span>
<span class="sd">    updated version of the weights.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights: dict[int: OrderedDict]</span>
<span class="sd">        Weights of the previous (central) model.</span>
<span class="sd">    gradients: dict[int: OrderedDict]</span>
<span class="sd">        Gradients (defined as trainedmodel - dispatched model)</span>
<span class="sd">    learning_rate: float</span>
<span class="sd">        Learning rate used to </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OrderedDict&quot;&quot;&quot;</span>        
    <span class="n">updated_weights</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">zeros</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
        <span class="n">updated_weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradients</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">updated_weights</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="simulations">Simulations</h2>
<p>Simulation class serve as a boilerplate code for simulating all the actions happening in the decentralised environment</p>


<div class="doc doc-object doc-module">



<a id="simulation.simulation"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="simulation.simulation.Simulation" class="doc doc-heading">
            <code>Simulation</code>


</h2>


    <div class="doc doc-contents ">


      <p>Simulation class representing a generic simulation type.</p>
<h4 id="simulation.simulation.Simulation--attributes">Attributes</h4>
<p>model_template : FederatedModel
    Initialized instance of a Federated Model class that is uploaded to every client.
node_template : FederatedNode
    Initialized instance of a Federated Node class that is used to simulate nodes.
data : dict
    Local data used for the training in a dictionary format, mapping each client to its respective dataset.</p>

              <details class="quote">
                <summary>Source code in <code>FedJust\simulation\simulation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Simulation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulation class representing a generic simulation type.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        model_template : FederatedModel</span>
<span class="sd">            Initialized instance of a Federated Model class that is uploaded to every client.</span>
<span class="sd">        node_template : FederatedNode</span>
<span class="sd">            Initialized instance of a Federated Node class that is used to simulate nodes.</span>
<span class="sd">        data : dict</span>
<span class="sd">            Local data used for the training in a dictionary format, mapping each client to its respective dataset.</span>
<span class="sd">        &quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">model_template</span><span class="p">:</span> <span class="n">FederatedModel</span><span class="p">,</span>
                 <span class="n">node_template</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">,</span>
                 <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creating simulation instant requires providing an already created instance of model template</span>
<span class="sd">        and node template. Those instances then will be copied n-times to create n different nodes, each</span>
<span class="sd">        with a different dataset. Additionally, a data for local nodes should be passed in form of a dictionary,</span>
<span class="sd">        maping dataset to each respective client.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        model_template : FederatedModel</span>
<span class="sd">            Initialized instance of a Federated Model class that will be uploaded to every client.</span>
<span class="sd">        node_template : FederatedNode</span>
<span class="sd">            Initialized instance of a Federated Node class that will be used to simulate nodes.</span>
<span class="sd">        seed : int,</span>
<span class="sd">            Seed for the simulation, default to 42</span>
<span class="sd">        **kwargs : dict, optional</span>
<span class="sd">            Extra arguments to enable selected features of the Orchestrator.</span>
<span class="sd">            passing full_debug to **kwargs, allow to enter a full debug mode.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_template</span> <span class="o">=</span> <span class="n">model_template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_template</span> <span class="o">=</span> <span class="n">node_template</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">attach_orchestrator_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                  <span class="n">orchestrator_data</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attaches model of the orchestrator that is saved as an instance attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        orchestrator_data: Any </span>
<span class="sd">            Orchestrator data that should be attached to the orchestrator model.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_template</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">attach_dataset_id</span><span class="p">(</span><span class="n">local_dataset</span><span class="o">=</span><span class="p">[</span><span class="n">orchestrator_data</span><span class="p">],</span>
                                                  <span class="n">node_name</span><span class="o">=</span><span class="s1">&#39;orchestrator&#39;</span><span class="p">,</span>
                                                  <span class="n">only_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">attach_node_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">nodes_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attaches models of the nodes to the simulation instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        orchestrator_data: Any</span>
<span class="sd">            Orchestrator data that should be attached to nodes models.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">nodes_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_template</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="o">.</span><span class="n">connect_data_id</span><span class="p">(</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">node_id</span><span class="p">,</span>
                                                  <span class="n">model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_template</span><span class="p">),</span>
                                                  <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">train_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">sampled_nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">],</span>
                    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                    <span class="n">local_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;weights&#39;</span><span class="p">,</span>
                    <span class="n">save_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs one training round of a federated learning. Returns training</span>
<span class="sd">        results upon completion.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        samples_nodes: dict[int: FederatedNode]</span>
<span class="sd">            Dictionary containing sampled Federated Nodes</span>
<span class="sd">        iteration: int</span>
<span class="sd">            Current global iteration of the training process</span>
<span class="sd">        local_epochs: int</span>
<span class="sd">            Number of local epochs for which the local model should</span>
<span class="sd">            be trained.</span>
<span class="sd">        mode: str (default to &#39;weights&#39;)</span>
<span class="sd">            Mode = &#39;weights&#39;: Node will return model&#39;s weights.</span>
<span class="sd">            Mode = &#39;gradients&#39;: Node will return model&#39;s gradients.</span>
<span class="sd">        save_model: bool (default to False)</span>
<span class="sd">            Boolean flag to save a model.</span>
<span class="sd">        save_path: str (defualt to None)</span>
<span class="sd">            Path object used to save a model</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple[dict[int, int, float, float, list, list], dict[int, OrderedDict]]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">training_results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sampled_nodes</span><span class="p">))</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">train_nodes</span><span class="p">,</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">local_epochs</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">save_model</span><span class="p">,</span> <span class="n">save_path</span><span class="p">))</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sampled_nodes</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">node_id</span><span class="p">,</span> <span class="n">model_weights</span><span class="p">,</span> <span class="n">loss_list</span><span class="p">,</span> <span class="n">accuracy_list</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
                <span class="n">weights</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_weights</span>
                <span class="n">training_results</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;iteration&quot;</span><span class="p">:</span> <span class="n">iteration</span><span class="p">,</span>
                    <span class="s2">&quot;node_id&quot;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
                    <span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="n">loss_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                    <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                    <span class="s2">&quot;full_loss&quot;</span><span class="p">:</span> <span class="n">loss_list</span><span class="p">,</span>
                    <span class="s2">&quot;full_accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy_list</span><span class="p">}</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">training_results</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">training_protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">local_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">aggrgator</span><span class="p">:</span> <span class="n">Aggregator</span><span class="p">,</span>
                          <span class="n">metrics_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">nodes_models_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">orchestrator_models_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs a full federated training according to the initialized</span>
<span class="sd">        settings. The train_protocol of the generic_orchestrator.Orchestrator</span>
<span class="sd">        follows a classic FedAvg algorithm - it averages the local weights </span>
<span class="sd">        and aggregates them taking a weighted average.</span>
<span class="sd">        SOURCE: Communication-Efficient Learning of</span>
<span class="sd">        Deep Networks from Decentralized Data, H.B. McMahan et al.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iterations: int</span>
<span class="sd">            Number of (global) iterations // epochs to train the models for.</span>
<span class="sd">        sample_size: int</span>
<span class="sd">            Size of the sample</span>
<span class="sd">        local_epochs: int</span>
<span class="sd">            Number of local epochs for which the local model should</span>
<span class="sd">            be trained.</span>
<span class="sd">        aggregator: Aggregator</span>
<span class="sd">            Instance of the Aggregator object that will be used to aggregate the result each round</span>
<span class="sd">        metrics_savepath: str</span>
<span class="sd">            Path for saving the metrics</span>
<span class="sd">        nodes_models_savepath: str</span>
<span class="sd">            Path for saving the models in the .pt format.</span>
<span class="sd">        orchestrator_models_savepath: str</span>
<span class="sd">            Path for saving the orchestrator models.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Returns 0 on the successful completion of the training.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
            <span class="n">orchestrator_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># # Updating weights for every node</span>
            <span class="c1"># for node in self.network.values():</span>
            <span class="c1">#     node.update_weights(copy.deepcopy(self.central_model.get_weights()))</span>

            <span class="c1"># Sampling nodes</span>
            <span class="n">sampled_nodes</span> <span class="o">=</span> <span class="n">sample_nodes</span><span class="p">(</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                <span class="n">sample_size</span> <span class="o">=</span> <span class="n">sample_size</span><span class="p">,</span>
                <span class="n">generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span>
            <span class="p">)</span>

            <span class="c1"># Training nodes</span>
            <span class="n">training_results</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_epoch</span><span class="p">(</span>
                <span class="n">sampled_nodes</span><span class="o">=</span><span class="n">sampled_nodes</span><span class="p">,</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                <span class="n">local_epochs</span><span class="o">=</span><span class="n">local_epochs</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;weights&#39;</span><span class="p">,</span>
                <span class="n">save_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">nodes_models_savepath</span>
            <span class="p">)</span>

            <span class="c1"># Preserving metrics of the training</span>
            <span class="n">save_nested_dict_ascsv</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">training_results</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s1">&#39;training_metrics.csv&#39;</span><span class="p">))</span>

            <span class="c1"># Testing nodes on the local dataset before the model update (only sampled nodes).</span>
            <span class="n">automatic_node_evaluation</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                <span class="n">nodes</span><span class="o">=</span><span class="n">sampled_nodes</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;before_update_metrics.csv&quot;</span><span class="p">))</span>

            <span class="c1"># Updating weights</span>
            <span class="n">new_weights</span> <span class="o">=</span> <span class="n">aggrgator</span><span class="o">.</span><span class="n">aggregate_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

            <span class="c1"># Updating weights for each node in the network</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">node</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>
            <span class="c1"># Updating the weights for the central model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>

            <span class="c1"># Preserving the orchestrator&#39;s model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">store_model_on_disk</span><span class="p">(</span><span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                                                        <span class="n">path</span><span class="o">=</span><span class="n">orchestrator_models_savepath</span><span class="p">)</span>

            <span class="c1"># Evaluating the new set of weights on local datasets.</span>
            <span class="n">automatic_node_evaluation</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                <span class="n">nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;after_update_metrics.csv&quot;</span><span class="p">))</span>
            <span class="c1"># Evaluating the new set of weights on orchestrator&#39;s dataset.</span>
            <span class="n">evaluate_model</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;orchestrator_metrics.csv&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="simulation.simulation.Simulation.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">model_template</span><span class="p">,</span> <span class="n">node_template</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Creating simulation instant requires providing an already created instance of model template
and node template. Those instances then will be copied n-times to create n different nodes, each
with a different dataset. Additionally, a data for local nodes should be passed in form of a dictionary,
maping dataset to each respective client.</p>
<h5 id="simulation.simulation.Simulation.__init__--parameters">Parameters</h5>
<p>model_template : FederatedModel
    Initialized instance of a Federated Model class that will be uploaded to every client.
node_template : FederatedNode
    Initialized instance of a Federated Node class that will be used to simulate nodes.
seed : int,
    Seed for the simulation, default to 42
<strong>kwargs : dict, optional
    Extra arguments to enable selected features of the Orchestrator.
    passing full_debug to </strong>kwargs, allow to enter a full debug mode.</p>
<h5 id="simulation.simulation.Simulation.__init__--returns">Returns</h5>
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\simulation\simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
             <span class="n">model_template</span><span class="p">:</span> <span class="n">FederatedModel</span><span class="p">,</span>
             <span class="n">node_template</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">,</span>
             <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creating simulation instant requires providing an already created instance of model template</span>
<span class="sd">    and node template. Those instances then will be copied n-times to create n different nodes, each</span>
<span class="sd">    with a different dataset. Additionally, a data for local nodes should be passed in form of a dictionary,</span>
<span class="sd">    maping dataset to each respective client.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    model_template : FederatedModel</span>
<span class="sd">        Initialized instance of a Federated Model class that will be uploaded to every client.</span>
<span class="sd">    node_template : FederatedNode</span>
<span class="sd">        Initialized instance of a Federated Node class that will be used to simulate nodes.</span>
<span class="sd">    seed : int,</span>
<span class="sd">        Seed for the simulation, default to 42</span>
<span class="sd">    **kwargs : dict, optional</span>
<span class="sd">        Extra arguments to enable selected features of the Orchestrator.</span>
<span class="sd">        passing full_debug to **kwargs, allow to enter a full debug mode.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_template</span> <span class="o">=</span> <span class="n">model_template</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_template</span> <span class="o">=</span> <span class="n">node_template</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">generator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="simulation.simulation.Simulation.attach_node_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_node_model</span><span class="p">(</span><span class="n">nodes_data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Attaches models of the nodes to the simulation instance.</p>
<h5 id="simulation.simulation.Simulation.attach_node_model--parameters">Parameters</h5>
<p>orchestrator_data: Any
    Orchestrator data that should be attached to nodes models.
Returns</p>
<hr />
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\simulation\simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">attach_node_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">nodes_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Attaches models of the nodes to the simulation instance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    orchestrator_data: Any</span>
<span class="sd">        Orchestrator data that should be attached to nodes models.</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node_id</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">nodes_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node_template</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span><span class="o">.</span><span class="n">connect_data_id</span><span class="p">(</span><span class="n">node_id</span> <span class="o">=</span> <span class="n">node_id</span><span class="p">,</span>
                                              <span class="n">model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_template</span><span class="p">),</span>
                                              <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="simulation.simulation.Simulation.attach_orchestrator_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">attach_orchestrator_model</span><span class="p">(</span><span class="n">orchestrator_data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Attaches model of the orchestrator that is saved as an instance attribute.</p>
<h5 id="simulation.simulation.Simulation.attach_orchestrator_model--parameters">Parameters</h5>
<p>orchestrator_data: Any 
    Orchestrator data that should be attached to the orchestrator model.</p>
<h5 id="simulation.simulation.Simulation.attach_orchestrator_model--returns">Returns</h5>
<p>None</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\simulation\simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">attach_orchestrator_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                              <span class="n">orchestrator_data</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Attaches model of the orchestrator that is saved as an instance attribute.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    orchestrator_data: Any </span>
<span class="sd">        Orchestrator data that should be attached to the orchestrator model.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_template</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">attach_dataset_id</span><span class="p">(</span><span class="n">local_dataset</span><span class="o">=</span><span class="p">[</span><span class="n">orchestrator_data</span><span class="p">],</span>
                                              <span class="n">node_name</span><span class="o">=</span><span class="s1">&#39;orchestrator&#39;</span><span class="p">,</span>
                                              <span class="n">only_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="simulation.simulation.Simulation.train_epoch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_epoch</span><span class="p">(</span><span class="n">sampled_nodes</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">local_epochs</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;weights&#39;</span><span class="p">,</span> <span class="n">save_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Performs one training round of a federated learning. Returns training
results upon completion.</p>
<h5 id="simulation.simulation.Simulation.train_epoch--parameters">Parameters</h5>
<p>samples_nodes: dict[int: FederatedNode]
    Dictionary containing sampled Federated Nodes
iteration: int
    Current global iteration of the training process
local_epochs: int
    Number of local epochs for which the local model should
    be trained.
mode: str (default to 'weights')
    Mode = 'weights': Node will return model's weights.
    Mode = 'gradients': Node will return model's gradients.
save_model: bool (default to False)
    Boolean flag to save a model.
save_path: str (defualt to None)
    Path object used to save a model</p>
<h5 id="simulation.simulation.Simulation.train_epoch--returns">Returns</h5>
<p>tuple[dict[int, int, float, float, list, list], dict[int, OrderedDict]]</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\simulation\simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_epoch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">sampled_nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">],</span>
                <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                <span class="n">local_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
                <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;weights&#39;</span><span class="p">,</span>
                <span class="n">save_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs one training round of a federated learning. Returns training</span>
<span class="sd">    results upon completion.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    samples_nodes: dict[int: FederatedNode]</span>
<span class="sd">        Dictionary containing sampled Federated Nodes</span>
<span class="sd">    iteration: int</span>
<span class="sd">        Current global iteration of the training process</span>
<span class="sd">    local_epochs: int</span>
<span class="sd">        Number of local epochs for which the local model should</span>
<span class="sd">        be trained.</span>
<span class="sd">    mode: str (default to &#39;weights&#39;)</span>
<span class="sd">        Mode = &#39;weights&#39;: Node will return model&#39;s weights.</span>
<span class="sd">        Mode = &#39;gradients&#39;: Node will return model&#39;s gradients.</span>
<span class="sd">    save_model: bool (default to False)</span>
<span class="sd">        Boolean flag to save a model.</span>
<span class="sd">    save_path: str (defualt to None)</span>
<span class="sd">        Path object used to save a model</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    tuple[dict[int, int, float, float, list, list], dict[int, OrderedDict]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">training_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">with</span> <span class="n">Pool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sampled_nodes</span><span class="p">))</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">pool</span><span class="o">.</span><span class="n">apply_async</span><span class="p">(</span><span class="n">train_nodes</span><span class="p">,</span> <span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">local_epochs</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">save_model</span><span class="p">,</span> <span class="n">save_path</span><span class="p">))</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">sampled_nodes</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">node_id</span><span class="p">,</span> <span class="n">model_weights</span><span class="p">,</span> <span class="n">loss_list</span><span class="p">,</span> <span class="n">accuracy_list</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="n">weights</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_weights</span>
            <span class="n">training_results</span><span class="p">[</span><span class="n">node_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;iteration&quot;</span><span class="p">:</span> <span class="n">iteration</span><span class="p">,</span>
                <span class="s2">&quot;node_id&quot;</span><span class="p">:</span> <span class="n">node_id</span><span class="p">,</span>
                <span class="s2">&quot;loss&quot;</span><span class="p">:</span> <span class="n">loss_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
                <span class="s2">&quot;accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                <span class="s2">&quot;full_loss&quot;</span><span class="p">:</span> <span class="n">loss_list</span><span class="p">,</span>
                <span class="s2">&quot;full_accuracy&quot;</span><span class="p">:</span> <span class="n">accuracy_list</span><span class="p">}</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">training_results</span><span class="p">,</span> <span class="n">weights</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="simulation.simulation.Simulation.training_protocol" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">training_protocol</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">local_epochs</span><span class="p">,</span> <span class="n">aggrgator</span><span class="p">,</span> <span class="n">metrics_savepath</span><span class="p">,</span> <span class="n">nodes_models_savepath</span><span class="p">,</span> <span class="n">orchestrator_models_savepath</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Performs a full federated training according to the initialized
settings. The train_protocol of the generic_orchestrator.Orchestrator
follows a classic FedAvg algorithm - it averages the local weights 
and aggregates them taking a weighted average.
SOURCE: Communication-Efficient Learning of
Deep Networks from Decentralized Data, H.B. McMahan et al.</p>
<h5 id="simulation.simulation.Simulation.training_protocol--parameters">Parameters</h5>
<p>iterations: int
    Number of (global) iterations // epochs to train the models for.
sample_size: int
    Size of the sample
local_epochs: int
    Number of local epochs for which the local model should
    be trained.
aggregator: Aggregator
    Instance of the Aggregator object that will be used to aggregate the result each round
metrics_savepath: str
    Path for saving the metrics
nodes_models_savepath: str
    Path for saving the models in the .pt format.
orchestrator_models_savepath: str
    Path for saving the orchestrator models.</p>
<h5 id="simulation.simulation.Simulation.training_protocol--returns">Returns</h5>
<p>int
    Returns 0 on the successful completion of the training.</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\simulation\simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">training_protocol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                      <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                      <span class="n">local_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                      <span class="n">aggrgator</span><span class="p">:</span> <span class="n">Aggregator</span><span class="p">,</span>
                      <span class="n">metrics_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">nodes_models_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                      <span class="n">orchestrator_models_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs a full federated training according to the initialized</span>
<span class="sd">    settings. The train_protocol of the generic_orchestrator.Orchestrator</span>
<span class="sd">    follows a classic FedAvg algorithm - it averages the local weights </span>
<span class="sd">    and aggregates them taking a weighted average.</span>
<span class="sd">    SOURCE: Communication-Efficient Learning of</span>
<span class="sd">    Deep Networks from Decentralized Data, H.B. McMahan et al.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iterations: int</span>
<span class="sd">        Number of (global) iterations // epochs to train the models for.</span>
<span class="sd">    sample_size: int</span>
<span class="sd">        Size of the sample</span>
<span class="sd">    local_epochs: int</span>
<span class="sd">        Number of local epochs for which the local model should</span>
<span class="sd">        be trained.</span>
<span class="sd">    aggregator: Aggregator</span>
<span class="sd">        Instance of the Aggregator object that will be used to aggregate the result each round</span>
<span class="sd">    metrics_savepath: str</span>
<span class="sd">        Path for saving the metrics</span>
<span class="sd">    nodes_models_savepath: str</span>
<span class="sd">        Path for saving the models in the .pt format.</span>
<span class="sd">    orchestrator_models_savepath: str</span>
<span class="sd">        Path for saving the orchestrator models.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Returns 0 on the successful completion of the training.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="n">orchestrator_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># # Updating weights for every node</span>
        <span class="c1"># for node in self.network.values():</span>
        <span class="c1">#     node.update_weights(copy.deepcopy(self.central_model.get_weights()))</span>

        <span class="c1"># Sampling nodes</span>
        <span class="n">sampled_nodes</span> <span class="o">=</span> <span class="n">sample_nodes</span><span class="p">(</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
            <span class="n">sample_size</span> <span class="o">=</span> <span class="n">sample_size</span><span class="p">,</span>
            <span class="n">generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span>
        <span class="p">)</span>

        <span class="c1"># Training nodes</span>
        <span class="n">training_results</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_epoch</span><span class="p">(</span>
            <span class="n">sampled_nodes</span><span class="o">=</span><span class="n">sampled_nodes</span><span class="p">,</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">local_epochs</span><span class="o">=</span><span class="n">local_epochs</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;weights&#39;</span><span class="p">,</span>
            <span class="n">save_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">nodes_models_savepath</span>
        <span class="p">)</span>

        <span class="c1"># Preserving metrics of the training</span>
        <span class="n">save_nested_dict_ascsv</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">training_results</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s1">&#39;training_metrics.csv&#39;</span><span class="p">))</span>

        <span class="c1"># Testing nodes on the local dataset before the model update (only sampled nodes).</span>
        <span class="n">automatic_node_evaluation</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">nodes</span><span class="o">=</span><span class="n">sampled_nodes</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;before_update_metrics.csv&quot;</span><span class="p">))</span>

        <span class="c1"># Updating weights</span>
        <span class="n">new_weights</span> <span class="o">=</span> <span class="n">aggrgator</span><span class="o">.</span><span class="n">aggregate_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>

        <span class="c1"># Updating weights for each node in the network</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">node</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>
        <span class="c1"># Updating the weights for the central model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>

        <span class="c1"># Preserving the orchestrator&#39;s model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">store_model_on_disk</span><span class="p">(</span><span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                                                    <span class="n">path</span><span class="o">=</span><span class="n">orchestrator_models_savepath</span><span class="p">)</span>

        <span class="c1"># Evaluating the new set of weights on local datasets.</span>
        <span class="n">automatic_node_evaluation</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;after_update_metrics.csv&quot;</span><span class="p">))</span>
        <span class="c1"># Evaluating the new set of weights on orchestrator&#39;s dataset.</span>
        <span class="n">evaluate_model</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;orchestrator_metrics.csv&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="simulation.adaptive_optimizer_simulation"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation" class="doc doc-heading">
            <code>Adaptive_Optimizer_Simulation</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="FedJust.simulation.simulation.Simulation">Simulation</span></code></p>


      <p>Simulation class representing a generic simulation type.</p>
<h4 id="simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation--attributes">Attributes</h4>
<p>model_template : FederatedModel
    Initialized instance of a Federated Model class that is uploaded to every client.
node_template : FederatedNode
    Initialized instance of a Federated Node class that is used to simulate nodes.
data : dict
    Local data used for the training in a dictionary format, mapping each client to its respective dataset.</p>

              <details class="quote">
                <summary>Source code in <code>FedJust\simulation\adaptive_optimizer_simulation.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Adaptive_Optimizer_Simulation</span><span class="p">(</span><span class="n">Simulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simulation class representing a generic simulation type.</span>

<span class="sd">        Attributes</span>
<span class="sd">        ----------</span>
<span class="sd">        model_template : FederatedModel</span>
<span class="sd">            Initialized instance of a Federated Model class that is uploaded to every client.</span>
<span class="sd">        node_template : FederatedNode</span>
<span class="sd">            Initialized instance of a Federated Node class that is used to simulate nodes.</span>
<span class="sd">        data : dict</span>
<span class="sd">            Local data used for the training in a dictionary format, mapping each client to its respective dataset.&quot;&quot;&quot;</span>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">model_template</span><span class="p">:</span> <span class="n">FederatedModel</span><span class="p">,</span> 
        <span class="n">node_template</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">,</span> 
        <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span> 
        <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">model_template</span><span class="p">,</span> <span class="n">node_template</span><span class="p">,</span> <span class="n">seed</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">training_protocol</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">local_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">aggrgator</span><span class="p">:</span> <span class="n">Aggregator</span><span class="p">,</span>
        <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">metrics_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">nodes_models_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">orchestrator_models_savepath</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Performs a full federated training according to the initialized</span>
<span class="sd">        settings. The train_protocol of the generic_orchestrator.Orchestrator</span>
<span class="sd">        follows a classic FedOpt algorithm - it averages the local gradients </span>
<span class="sd">        and aggregates them using a selecred optimizer.</span>
<span class="sd">        SOURCE: </span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        iterations: int</span>
<span class="sd">            Number of (global) iterations // epochs to train the models for.</span>
<span class="sd">        sample_size: int</span>
<span class="sd">            Size of the sample</span>
<span class="sd">        local_epochs: int</span>
<span class="sd">            Number of local epochs for which the local model should</span>
<span class="sd">            be trained.</span>
<span class="sd">        aggregator: Aggregator</span>
<span class="sd">            Instance of the Aggregator object that will be used to aggregate the result each round</span>
<span class="sd">        learning_rate: float</span>
<span class="sd">            Learning rate to be used for optimization.</span>
<span class="sd">        metrics_savepath: str</span>
<span class="sd">            Path for saving the metrics</span>
<span class="sd">        nodes_models_savepath: str</span>
<span class="sd">            Path for saving the models in the .pt format.</span>
<span class="sd">        orchestrator_models_savepath: str</span>
<span class="sd">            Path for saving the orchestrator models.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            Returns 0 on the successful completion of the training.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
            <span class="n">orchestrator_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># # Updating weights for every node</span>
            <span class="c1"># for node in self.network.values():</span>
            <span class="c1">#     node.update_weights(copy.deepcopy(self.central_model.get_weights()))</span>

            <span class="c1"># Sampling nodes</span>
            <span class="n">sampled_nodes</span> <span class="o">=</span> <span class="n">sample_nodes</span><span class="p">(</span>
                <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                <span class="n">sample_size</span> <span class="o">=</span> <span class="n">sample_size</span><span class="p">,</span>
                <span class="n">generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span>
            <span class="p">)</span>

            <span class="c1"># Training nodes</span>
            <span class="n">training_results</span><span class="p">,</span> <span class="n">gradients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_epoch</span><span class="p">(</span>
                <span class="n">sampled_nodes</span><span class="o">=</span><span class="n">sampled_nodes</span><span class="p">,</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                <span class="n">local_epochs</span><span class="o">=</span><span class="n">local_epochs</span><span class="p">,</span>
                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;gradients&#39;</span><span class="p">,</span>
                <span class="n">save_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">nodes_models_savepath</span>
            <span class="p">)</span>

            <span class="c1"># Preserving metrics of the training</span>
            <span class="n">save_nested_dict_ascsv</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="n">training_results</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s1">&#39;training_metrics.csv&#39;</span><span class="p">))</span>

            <span class="c1"># Testing nodes on the local dataset before the model update (only sampled nodes).</span>
            <span class="n">automatic_node_evaluation</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                <span class="n">nodes</span><span class="o">=</span><span class="n">sampled_nodes</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;before_update_metrics.csv&quot;</span><span class="p">))</span>

            <span class="n">avg_gradients</span> <span class="o">=</span> <span class="n">average_of_weigts</span><span class="p">(</span><span class="n">gradients</span><span class="p">)</span>
            <span class="c1"># Updating weights</span>
            <span class="n">new_weights</span> <span class="o">=</span> <span class="n">aggrgator</span><span class="o">.</span><span class="n">optimize_weights</span><span class="p">(</span>
                <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">get_weights</span><span class="p">(),</span>
                <span class="n">gradients</span> <span class="o">=</span> <span class="n">avg_gradients</span><span class="p">,</span>
                <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Updating weights for each node in the network</span>
            <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">node</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>
            <span class="c1"># Updating the weights for the central model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>

            <span class="c1"># Preserving the orchestrator&#39;s model</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">store_model_on_disk</span><span class="p">(</span><span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                                                        <span class="n">path</span><span class="o">=</span><span class="n">orchestrator_models_savepath</span><span class="p">)</span>

            <span class="c1"># Evaluating the new set of weights on local datasets.</span>
            <span class="n">automatic_node_evaluation</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                <span class="n">nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;after_update_metrics.csv&quot;</span><span class="p">))</span>
            <span class="c1"># Evaluating the new set of weights on orchestrator&#39;s dataset.</span>
            <span class="n">evaluate_model</span><span class="p">(</span>
                <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="p">,</span>
                <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;orchestrator_metrics.csv&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation.training_protocol" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">training_protocol</span><span class="p">(</span><span class="n">iterations</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">local_epochs</span><span class="p">,</span> <span class="n">aggrgator</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">,</span> <span class="n">metrics_savepath</span><span class="p">,</span> <span class="n">nodes_models_savepath</span><span class="p">,</span> <span class="n">orchestrator_models_savepath</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Performs a full federated training according to the initialized
settings. The train_protocol of the generic_orchestrator.Orchestrator
follows a classic FedOpt algorithm - it averages the local gradients 
and aggregates them using a selecred optimizer.
SOURCE: </p>
<h5 id="simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation.training_protocol--parameters">Parameters</h5>
<p>iterations: int
    Number of (global) iterations // epochs to train the models for.
sample_size: int
    Size of the sample
local_epochs: int
    Number of local epochs for which the local model should
    be trained.
aggregator: Aggregator
    Instance of the Aggregator object that will be used to aggregate the result each round
learning_rate: float
    Learning rate to be used for optimization.
metrics_savepath: str
    Path for saving the metrics
nodes_models_savepath: str
    Path for saving the models in the .pt format.
orchestrator_models_savepath: str
    Path for saving the orchestrator models.</p>
<h5 id="simulation.adaptive_optimizer_simulation.Adaptive_Optimizer_Simulation.training_protocol--returns">Returns</h5>
<p>int
    Returns 0 on the successful completion of the training.</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\simulation\adaptive_optimizer_simulation.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">training_protocol</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">iterations</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">local_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">aggrgator</span><span class="p">:</span> <span class="n">Aggregator</span><span class="p">,</span>
    <span class="n">learning_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">metrics_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">nodes_models_savepath</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">orchestrator_models_savepath</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs a full federated training according to the initialized</span>
<span class="sd">    settings. The train_protocol of the generic_orchestrator.Orchestrator</span>
<span class="sd">    follows a classic FedOpt algorithm - it averages the local gradients </span>
<span class="sd">    and aggregates them using a selecred optimizer.</span>
<span class="sd">    SOURCE: </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iterations: int</span>
<span class="sd">        Number of (global) iterations // epochs to train the models for.</span>
<span class="sd">    sample_size: int</span>
<span class="sd">        Size of the sample</span>
<span class="sd">    local_epochs: int</span>
<span class="sd">        Number of local epochs for which the local model should</span>
<span class="sd">        be trained.</span>
<span class="sd">    aggregator: Aggregator</span>
<span class="sd">        Instance of the Aggregator object that will be used to aggregate the result each round</span>
<span class="sd">    learning_rate: float</span>
<span class="sd">        Learning rate to be used for optimization.</span>
<span class="sd">    metrics_savepath: str</span>
<span class="sd">        Path for saving the metrics</span>
<span class="sd">    nodes_models_savepath: str</span>
<span class="sd">        Path for saving the models in the .pt format.</span>
<span class="sd">    orchestrator_models_savepath: str</span>
<span class="sd">        Path for saving the orchestrator models.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    int</span>
<span class="sd">        Returns 0 on the successful completion of the training.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">iteration</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">iterations</span><span class="p">):</span>
        <span class="n">orchestrator_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">iteration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># # Updating weights for every node</span>
        <span class="c1"># for node in self.network.values():</span>
        <span class="c1">#     node.update_weights(copy.deepcopy(self.central_model.get_weights()))</span>

        <span class="c1"># Sampling nodes</span>
        <span class="n">sampled_nodes</span> <span class="o">=</span> <span class="n">sample_nodes</span><span class="p">(</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
            <span class="n">sample_size</span> <span class="o">=</span> <span class="n">sample_size</span><span class="p">,</span>
            <span class="n">generator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generator</span>
        <span class="p">)</span>

        <span class="c1"># Training nodes</span>
        <span class="n">training_results</span><span class="p">,</span> <span class="n">gradients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_epoch</span><span class="p">(</span>
            <span class="n">sampled_nodes</span><span class="o">=</span><span class="n">sampled_nodes</span><span class="p">,</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">local_epochs</span><span class="o">=</span><span class="n">local_epochs</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;gradients&#39;</span><span class="p">,</span>
            <span class="n">save_model</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">nodes_models_savepath</span>
        <span class="p">)</span>

        <span class="c1"># Preserving metrics of the training</span>
        <span class="n">save_nested_dict_ascsv</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="n">training_results</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s1">&#39;training_metrics.csv&#39;</span><span class="p">))</span>

        <span class="c1"># Testing nodes on the local dataset before the model update (only sampled nodes).</span>
        <span class="n">automatic_node_evaluation</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">nodes</span><span class="o">=</span><span class="n">sampled_nodes</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;before_update_metrics.csv&quot;</span><span class="p">))</span>

        <span class="n">avg_gradients</span> <span class="o">=</span> <span class="n">average_of_weigts</span><span class="p">(</span><span class="n">gradients</span><span class="p">)</span>
        <span class="c1"># Updating weights</span>
        <span class="n">new_weights</span> <span class="o">=</span> <span class="n">aggrgator</span><span class="o">.</span><span class="n">optimize_weights</span><span class="p">(</span>
            <span class="n">weights</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">get_weights</span><span class="p">(),</span>
            <span class="n">gradients</span> <span class="o">=</span> <span class="n">avg_gradients</span><span class="p">,</span>
            <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Updating weights for each node in the network</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">node</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>
        <span class="c1"># Updating the weights for the central model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">update_weights</span><span class="p">(</span><span class="n">new_weights</span><span class="p">)</span>

        <span class="c1"># Preserving the orchestrator&#39;s model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="o">.</span><span class="n">store_model_on_disk</span><span class="p">(</span><span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
                                                    <span class="n">path</span><span class="o">=</span><span class="n">orchestrator_models_savepath</span><span class="p">)</span>

        <span class="c1"># Evaluating the new set of weights on local datasets.</span>
        <span class="n">automatic_node_evaluation</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">nodes</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;after_update_metrics.csv&quot;</span><span class="p">))</span>
        <span class="c1"># Evaluating the new set of weights on orchestrator&#39;s dataset.</span>
        <span class="n">evaluate_model</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">orchestrator_model</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">metrics_savepath</span><span class="p">,</span> <span class="s2">&quot;orchestrator_metrics.csv&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="opearations">Opearations</h2>
<p>A boilerplate code for some additional operations performed in a Federated scenario.</p>


<div class="doc doc-object doc-module">



<a id="operations.evaluations"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="operations.evaluations.automatic_node_evaluation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">automatic_node_evaluation</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_to_screen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Used to automatically evaluate a set of provided node and preserve metrics in the indicated 
directory.</p>
<h4 id="operations.evaluations.automatic_node_evaluation--parameters">Parameters</h4>
<p>iteration: int 
    Current iteration of the training.
nodes: dict[int: FederatedNode]
    Dictionary containing nodes to be evaluated.
saving_path: str (default to None)
    The saving path of the csv file, must end with the .csv extension.
logger: Logger (default to None)
    Logger object that we want to use to handle the logs.
log_to_screen: bool (default to False)
    Boolean flag whether we want to log the results to the screen.</p>
<h4 id="operations.evaluations.automatic_node_evaluation--returns">Returns</h4>
<pre><code>None
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\operations\evaluations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">automatic_node_evaluation</span><span class="p">(</span>
    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
    <span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">],</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log_to_screen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used to automatically evaluate a set of provided node and preserve metrics in the indicated </span>
<span class="sd">    directory.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iteration: int </span>
<span class="sd">        Current iteration of the training.</span>
<span class="sd">    nodes: dict[int: FederatedNode]</span>
<span class="sd">        Dictionary containing nodes to be evaluated.</span>
<span class="sd">    saving_path: str (default to None)</span>
<span class="sd">        The saving path of the csv file, must end with the .csv extension.</span>
<span class="sd">    logger: Logger (default to None)</span>
<span class="sd">        Logger object that we want to use to handle the logs.</span>
<span class="sd">    log_to_screen: bool (default to False)</span>
<span class="sd">        Boolean flag whether we want to log the results to the screen.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        None&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">evaluate_model</span><span class="p">(</span>
            <span class="n">iteration</span><span class="o">=</span><span class="n">iteration</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
            <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">,</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span>
            <span class="n">log_to_screen</span><span class="o">=</span><span class="n">log_to_screen</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="operations.evaluations.evaluate_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluate_model</span><span class="p">(</span><span class="n">iteration</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">save_path</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">log_to_screen</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Used to save the model metrics.</p>
<h4 id="operations.evaluations.evaluate_model--parameters">Parameters</h4>
<p>iteration: int 
    Current iteration of the training.
model: FederatedModel
    FederatedModel to be evaluated
saving_path: str (default to None)
    The saving path of the csv file, must end with the .csv extension.
logger: Logger (default to None)
    Logger object that we want to use to handle the logs.
log_to_screen: bool (default to False)
    Boolean flag whether we want to log the results to the screen.</p>
<h4 id="operations.evaluations.evaluate_model--returns">Returns</h4>
<pre><code>None
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\operations\evaluations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">evaluate_model</span><span class="p">(</span>
    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> 
    <span class="n">model</span><span class="p">:</span> <span class="n">FederatedModel</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">logger</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">log_to_screen</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used to save the model metrics.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    iteration: int </span>
<span class="sd">        Current iteration of the training.</span>
<span class="sd">    model: FederatedModel</span>
<span class="sd">        FederatedModel to be evaluated</span>
<span class="sd">    saving_path: str (default to None)</span>
<span class="sd">        The saving path of the csv file, must end with the .csv extension.</span>
<span class="sd">    logger: Logger (default to None)</span>
<span class="sd">        Logger object that we want to use to handle the logs.</span>
<span class="sd">    log_to_screen: bool (default to False)</span>
<span class="sd">        Boolean flag whether we want to log the results to the screen.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        None&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">evaluation_results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">evaluate_model</span><span class="p">()</span>
        <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;node_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">node_name</span>
        <span class="n">evaluation_results</span><span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">iteration</span>
        <span class="k">if</span> <span class="n">log_to_screen</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">pass</span>
            <span class="c1">#logger.info(f&quot;Evaluating model after iteration {iteration} on node {model.node_name}. Results: {metrics}&quot;)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unable to compute metrics. </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_path</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a+&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">saved_file</span><span class="p">:</span>
            <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">saved_file</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">evaluation_results</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
            <span class="c1"># If the file does not exist, it will create it and write the header.</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">writer</span><span class="o">.</span><span class="n">writeheader</span><span class="p">()</span>
            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">evaluation_results</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="operations.orchestrations"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="operations.orchestrations.sample_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">generator</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Sample the nodes given the provided sample size. If sample_size is bigger
or equal to the number of av. nodes, the sampler will return the original list.</p>
<h4 id="operations.orchestrations.sample_nodes--parameters">Parameters</h4>
<pre><code>nodes: dict[int: FederatedNode]) 
    Original dictionary of nodes to be sampled from.
sample_size: int,
    Size of the sample
generator: np.random.Generator
    A numpy generator initialized on the server side.
</code></pre>
<h4 id="operations.orchestrations.sample_nodes--returns">Returns</h4>
<pre><code>dict[id: FederatedNode]
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\operations\orchestrations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">],</span> 
                 <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">generator</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">id</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample the nodes given the provided sample size. If sample_size is bigger</span>
<span class="sd">    or equal to the number of av. nodes, the sampler will return the original list.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        nodes: dict[int: FederatedNode]) </span>
<span class="sd">            Original dictionary of nodes to be sampled from.</span>
<span class="sd">        sample_size: int,</span>
<span class="sd">            Size of the sample</span>
<span class="sd">        generator: np.random.Generator</span>
<span class="sd">            A numpy generator initialized on the server side.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        dict[id: FederatedNode]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="c1"># Conversion to array</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">node_id</span><span class="p">:</span> <span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">}</span> <span class="c1"># Back-conversion to dicitonary</span>
    <span class="k">return</span> <span class="n">sample</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="operations.orchestrations.sample_weighted_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_weighted_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">sample_size</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">sampling_array</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Sample the nodes given the provided sample size. It requires passing a sampling array
containing list of weights associated with each node.</p>
<h4 id="operations.orchestrations.sample_weighted_nodes--parameters">Parameters</h4>
<pre><code>nodes: dict[int: FederatedNode]) 
    Original dictionary of nodes to be sampled from.
sample_size: int,
    Size of the sample
generator: np.random.Generator
    A numpy generator initialized on the server side.
sampling_array: np.array
    Sampling array containing weights for the sampling
</code></pre>
<h4 id="operations.orchestrations.sample_weighted_nodes--returns">Returns</h4>
<pre><code>dict[id: FederatedNode]
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\operations\orchestrations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sample_weighted_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">],</span> 
                          <span class="n">sample_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                          <span class="n">generator</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">Generator</span><span class="p">,</span>
                          <span class="n">sampling_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">id</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sample the nodes given the provided sample size. It requires passing a sampling array</span>
<span class="sd">    containing list of weights associated with each node.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">        nodes: dict[int: FederatedNode]) </span>
<span class="sd">            Original dictionary of nodes to be sampled from.</span>
<span class="sd">        sample_size: int,</span>
<span class="sd">            Size of the sample</span>
<span class="sd">        generator: np.random.Generator</span>
<span class="sd">            A numpy generator initialized on the server side.</span>
<span class="sd">        sampling_array: np.array</span>
<span class="sd">            Sampling array containing weights for the sampling</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        dict[id: FederatedNode]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">sample_size</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">sampling_array</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="p">{</span><span class="n">node</span><span class="o">.</span><span class="n">node_id</span><span class="p">:</span> <span class="n">node</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">sample</span><span class="p">}</span> <span class="c1"># Back-conversion to dicitonary</span>
    <span class="k">return</span> <span class="n">sample</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="operations.orchestrations.train_nodes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_nodes</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">iteration</span><span class="p">,</span> <span class="n">local_epochs</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;weights&#39;</span><span class="p">,</span> <span class="n">save_model</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

      <p>Used to command the node to start the local training.
Invokes .train_local_model method and returns the results.</p>
<h4 id="operations.orchestrations.train_nodes--parameters">Parameters</h4>
<p>node: FederatedNode 
    Node that we want to train.
iteration: int
    Current (global) iteration.
local_epochs: int
    Number of local epochs for which to train a node
mode: str (default to False)
    Mode of the training. 
    Mode = 'weights': Node will return model's weights.
    Mode = 'gradients': Node will return model's gradients.
save_model: bool (default to False)
    Boolean flag to enable model saving.
save_path: str (default to None)
    Save path for preserving a model (applicable only when save_model = True)
Returns</p>
<hr />
<pre><code>tpule[int, OrderedDict, List[float], List[float]]
</code></pre>

            <details class="quote">
              <summary>Source code in <code>FedJust\operations\orchestrations.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_nodes</span><span class="p">(</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">FederatedNode</span><span class="p">,</span>
    <span class="n">iteration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">local_epochs</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;weights&#39;</span><span class="p">,</span>
    <span class="n">save_model</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">save_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Used to command the node to start the local training.</span>
<span class="sd">    Invokes .train_local_model method and returns the results.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    node: FederatedNode </span>
<span class="sd">        Node that we want to train.</span>
<span class="sd">    iteration: int</span>
<span class="sd">        Current (global) iteration.</span>
<span class="sd">    local_epochs: int</span>
<span class="sd">        Number of local epochs for which to train a node</span>
<span class="sd">    mode: str (default to False)</span>
<span class="sd">        Mode of the training. </span>
<span class="sd">        Mode = &#39;weights&#39;: Node will return model&#39;s weights.</span>
<span class="sd">        Mode = &#39;gradients&#39;: Node will return model&#39;s gradients.</span>
<span class="sd">    save_model: bool (default to False)</span>
<span class="sd">        Boolean flag to enable model saving.</span>
<span class="sd">    save_path: str (default to None)</span>
<span class="sd">        Save path for preserving a model (applicable only when save_model = True)</span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">        tpule[int, OrderedDict, List[float], List[float]]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_id</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">loss_list</span><span class="p">,</span> <span class="n">accuracy_list</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">train_local_model</span><span class="p">(</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="n">iteration</span><span class="p">,</span>
        <span class="n">local_epochs</span> <span class="o">=</span> <span class="n">local_epochs</span><span class="p">,</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span><span class="p">,</span>
        <span class="n">save_model</span> <span class="o">=</span> <span class="n">save_model</span><span class="p">,</span>
        <span class="n">save_path</span><span class="o">=</span><span class="n">save_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">node_id</span><span class="p">,</span> <span class="n">weights</span><span class="p">,</span> <span class="n">loss_list</span><span class="p">,</span> <span class="n">accuracy_list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><h2 id="aggregators_1">Aggregators</h2>
<p>A boilerplate code for functions serving to merge the local weights.</p>


<div class="doc doc-object doc-module">



<a id="aggregators.aggregator"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aggregators.aggregator.Aggregator" class="doc doc-heading">
            <code>Aggregator</code>


</h2>


    <div class="doc doc-contents ">


      <p>Basic class for all Federated Aggregators</p>

              <details class="quote">
                <summary>Source code in <code>FedJust\aggregators\aggregator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Aggregator</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic class for all Federated Aggregators&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">pass</span>


    <span class="k">def</span> <span class="nf">aggregate_weights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Basic aggregate function (equal to FedAvg) that returns the aggregate version of the</span>
<span class="sd">        weights. Perform deepcopy on the passed parameters.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weights: dict[int: OrderedDict]</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict&quot;&quot;&quot;</span>

        <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="c1">#Here we could add copy and deepcopy</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregators.aggregator.Aggregator.aggregate_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">aggregate_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>Basic aggregate function (equal to FedAvg) that returns the aggregate version of the
weights. Perform deepcopy on the passed parameters.</p>
<h5 id="aggregators.aggregator.Aggregator.aggregate_weights--parameters">Parameters</h5>
<p>weights: dict[int: OrderedDict]</p>
<h5 id="aggregators.aggregator.Aggregator.aggregate_weights--returns">Returns</h5>
<p>OrderedDict</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\aggregators\aggregator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">aggregate_weights</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Basic aggregate function (equal to FedAvg) that returns the aggregate version of the</span>
<span class="sd">    weights. Perform deepcopy on the passed parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights: dict[int: OrderedDict]</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OrderedDict&quot;&quot;&quot;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="c1">#Here we could add copy and deepcopy</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
        <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="aggregators.fedopt_aggregator"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="aggregators.fedopt_aggregator.Fedopt_Optimizer" class="doc doc-heading">
            <code>Fedopt_Optimizer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="FedJust.aggregators.aggregator.Aggregator">Aggregator</span></code></p>


      <p>Fedopt Optimizer that performs a generalized 
version of Federated Averaging. Suitable for performing
Federated Optimization based on gradients, with 
verying learning rates.</p>
<h4 id="aggregators.fedopt_aggregator.Fedopt_Optimizer--attributes">Attributes</h4>
<p>None</p>

              <details class="quote">
                <summary>Source code in <code>FedJust\aggregators\fedopt_aggregator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Fedopt_Optimizer</span><span class="p">(</span><span class="n">Aggregator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fedopt Optimizer that performs a generalized </span>
<span class="sd">    version of Federated Averaging. Suitable for performing</span>
<span class="sd">    Federated Optimization based on gradients, with </span>
<span class="sd">    verying learning rates.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>


    <span class="k">def</span> <span class="nf">optimize_weights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span><span class="n">OrderedDict</span><span class="p">],</span>
        <span class="n">gradients</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">],</span>
        <span class="n">learning_rate</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;FedOpt Aggregation Function (equal to FedAvg when lr=1.0) that returns the </span>
<span class="sd">        updated version of the weights.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        weights: dict[int: OrderedDict]</span>
<span class="sd">            Weights of the previous (central) model.</span>
<span class="sd">        gradients: dict[int: OrderedDict]</span>
<span class="sd">            Gradients (defined as trainedmodel - dispatched model)</span>
<span class="sd">        learning_rate: float</span>
<span class="sd">            Learning rate used to </span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        OrderedDict&quot;&quot;&quot;</span>        
        <span class="n">updated_weights</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">zeros</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
            <span class="n">updated_weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradients</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">updated_weights</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">optimize_weights</span><span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">gradients</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

      <p>FedOpt Aggregation Function (equal to FedAvg when lr=1.0) that returns the 
updated version of the weights.</p>
<h5 id="aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--parameters">Parameters</h5>
<p>weights: dict[int: OrderedDict]
    Weights of the previous (central) model.
gradients: dict[int: OrderedDict]
    Gradients (defined as trainedmodel - dispatched model)
learning_rate: float
    Learning rate used to </p>
<h5 id="aggregators.fedopt_aggregator.Fedopt_Optimizer.optimize_weights--returns">Returns</h5>
<p>OrderedDict</p>

            <details class="quote">
              <summary>Source code in <code>FedJust\aggregators\fedopt_aggregator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">optimize_weights</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">weights</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span><span class="n">OrderedDict</span><span class="p">],</span>
    <span class="n">gradients</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">:</span> <span class="n">OrderedDict</span><span class="p">],</span>
    <span class="n">learning_rate</span> <span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderedDict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;FedOpt Aggregation Function (equal to FedAvg when lr=1.0) that returns the </span>
<span class="sd">    updated version of the weights.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    weights: dict[int: OrderedDict]</span>
<span class="sd">        Weights of the previous (central) model.</span>
<span class="sd">    gradients: dict[int: OrderedDict]</span>
<span class="sd">        Gradients (defined as trainedmodel - dispatched model)</span>
<span class="sd">    learning_rate: float</span>
<span class="sd">        Learning rate used to </span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    OrderedDict&quot;&quot;&quot;</span>        
    <span class="n">updated_weights</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">zeros</span><span class="p">(</span><span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">()))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">weights</span><span class="p">:</span>
        <span class="n">updated_weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">weights</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">gradients</span><span class="p">[</span><span class="n">key</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">updated_weights</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>